"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[1538],{62050:(L,j,c)=>{c.r(j),c.d(j,{DashboardReportPage:()=>F,default:()=>Mt});var a=c(74848),y=c(32196),m=c(96540),S=c(54148),v=c(84537),D=c(40845),X=c(42418),J=c(39419),Q=c(72255),k=c(77517),q=c(31678);function _(){return typeof window.ResizeObserver<"u"}function tt(t){const{ref:e,box:n,onResize:o}=t;(0,m.useEffect)(()=>{let s=e?.current;if(s)if(_()){const r=new window.ResizeObserver(i=>{i.length&&o()});return r.observe(s,{box:n}),()=>{s&&r.unobserve(s)}}else return window.addEventListener("resize",o,!1),()=>{window.removeEventListener("resize",o,!1)}},[o,e,n])}var N=c(24180),w=c(15054),et=c(74730),st=c(78011),nt=c(77422);function ot({scaleFactor:t,currentPage:e,totalPageCount:n}){const o=(0,D.$j)(),s=at(o,t);return(0,a.jsxs)("div",{className:s.footer,children:[(0,a.jsxs)("div",{className:s.pageCount,children:["Page ",e,"/",n]}),(0,a.jsx)("div",{className:s.logo,children:(0,a.jsx)("img",{className:s.logoImg,src:rt(),alt:"Report logo"})})]})}function rt(){const t=(0,N.zy)(),n=new URLSearchParams(t.search).get("reportLogo");return n?(0,nt.A)(n):st.xJ}function at(t,e){return{footer:(0,y.css)({bottom:0,height:t.spacing(4*e),width:"100%",display:"flex",alignItems:"center",marginBottom:t.spacing(1)}),pageCount:(0,y.css)({flex:1,textAlign:"center",fontWeight:t.typography.fontWeightMedium,fontSize:`${.85*e}rem`}),logo:(0,y.css)({top:t.spacing(.5*e),right:t.spacing(2+.5*e)}),logoImg:(0,y.css)({maxWidth:t.spacing(3*e),maxHeight:t.spacing(3*e)})}}const it=ot;var I=c(85858),W=c(47232),lt=c(67061);function ct(t){const e="YYYY-MM-DD HH:mm:ss Z",n=I.parse(t.from,!1,void 0,t.fiscalYearStartMonth),o=I.parse(t.to,!0,void 0,t.fiscalYearStartMonth),s=(0,W.oZ)(t.timeZone,n).format(e),r=(0,W.oZ)(t.timeZone,o).format(e);return{displayFrom:s,displayTo:r}}const B=(0,m.forwardRef)(({reportTitle:t,dashboardTitle:e,timeRange:n,scaleFactor:o,showTemplateVariables:s,variableControls:r},i)=>{const d=(0,D.$j)(),l=dt(d,o),{displayFrom:f,displayTo:p}=ct(n);return(0,a.jsxs)("div",{ref:i,className:l.header,children:[(0,a.jsxs)("div",{className:l.subHeader,children:[(0,a.jsxs)("div",{children:[t," - Generated on ",I.parse((0,W.KQ)(Date.now()))?.format("dddd, MMM DD YYYY")]}),(0,a.jsx)("div",{className:l.timeRangeBlock,children:(0,a.jsxs)("div",{children:["Data time range: ",f,(0,a.jsx)("br",{}),p]})})]}),(0,a.jsx)("div",{className:l.dashboardTitle,children:e}),(0,a.jsx)("hr",{className:l.divider}),s&&(0,a.jsx)("div",{className:l.subHeader,children:(0,a.jsx)(lt.B,{grow:1,wrap:"wrap",children:r?.map(u=>(0,a.jsx)(u.Component,{model:u},u.state.key))})})]})});function dt(t,e){return{subHeader:(0,y.css)({label:"subheader",display:"flex",fontWeight:t.typography.fontWeightMedium,fontSize:`${.85*e}rem`,paddingTop:t.spacing(2)}),timeRangeBlock:(0,y.css)({label:"time-range-block",display:"flex",justifyContent:"flex-end",textAlign:"right",flexGrow:1}),dashboardTitle:(0,y.css)({label:"dashboard-title",fontSize:`${1.7*e}rem`,fontWeight:t.typography.fontWeightMedium}),divider:(0,y.css)({marginTop:0,marginBottom:0}),header:(0,y.css)({marginBottom:t.spacing(2*e)})}}B.displayName="ReportHeader";const E=B;var G=c(41507);function ht(t,e,n,o){const s=t.slice(),r=[],i=Math.floor(n/(w.sD+w.dU));let d=i;o||(d=i/3);let l=0,f={items:[],h:0};r.push(f);let p=0,u=!1;for(let x=0;x<s.length;x++){const h=s[x],g=h instanceof v.tI,R={x:0,y:l,w:w.cV,h:g?e:u?d-e:d,render:()=>(0,a.jsx)(h.Component,{model:h},h.state.key)};if(g&&(s.splice(x+1,0,...h.state.children),p++),h instanceof G.U&&h.state.repeatedPanels&&h.state.repeatedPanels.length>0){s.splice(x+1,0,...h.state.repeatedPanels);continue}l>=i&&(f.pageBreakAfter=!0,l=0,R.y=0,f={items:[],h:0},r.push(f)),l+=R.h,f.items.push(R),f.h=R.y+R.h,u=g}return r}function ft(t,e,n){const o=t.slice(),s=[],r=Math.floor(n/(w.sD+w.dU));let i=0,d=!1,l={items:[],h:0};s.push(l);const f=ut(o);for(let p=0;p<f.length;p++){const u=f[p],x=u.isRow||!1,h=$(u,i,r,e,d),g=p<f.length-1?$(f[p+1],i,r,e,x):null;let R=Math.max(l.h,h.y+h.h),P=0;x&&g!=null&&(P=Math.max(l.h,g.y-e+1+g.h)),(R>r||x&&P>r)&&(l.pageBreakAfter=!0,i=u.y*e,h.y=0,l={items:[],h:0},s.push(l)),l.items.push(h),l.h=Math.max(l.h,h.y+h.h),x?(d=!0,i+=e-1):g!=null&&g.y!==h.y&&(d=!1)}return s}function ut(t){const e=t.slice(),n=[];for(let o=0;o<e.length;o++){const s=e[o];if(s instanceof G.U&&s.state.repeatedPanels&&s.state.repeatedPanels.length>0){const{repeatedPanels:r,x:i,y:d,height:l,width:f}=s.state;let p,u,x=l/r.length,h=f;if(s.getRepeatDirection()==="h"){const g=Math.ceil(r.length/s.getMaxPerRow());x=l/g,h=f/s.getMaxPerRow()}for(let g=0;g<r.length;g++){const R=r[g];s.getRepeatDirection()==="h"?(p=g%s.getMaxPerRow()*h,u=d+Math.floor(g/s.getMaxPerRow())*x):(p=i,u=d+g*x),n.push({x:p,y:u,w:h,h:x,render:()=>(0,a.jsx)(R.Component,{model:R},R.state.key)})}}else{let r=!1;s instanceof v.tI&&(r=!0,e.splice(o+1,0,...s.state.children)),n.push({x:s.state.x,y:s.state.y,w:s.state.width,h:s.state.height,render:()=>(0,a.jsx)(s.Component,{model:s},s.state.key),isRow:r})}}return n.sort((o,s)=>o.y-s.y)}function $(t,e,n,o,s){const r={x:t.x,y:t.y*o-e,w:t.w,h:t.h*o,render:t.render};return t.isRow&&(r.h=1),s&&r.h+1>n?r.h=n-1:r.h>n&&(r.h=n),r}function U(t){return{margin:[w.dU,w.dU],containerWidth:t,containerPadding:[0,0],cols:w.cV,rowHeight:w.sD,maxRows:1e4}}function T(t){const{margin:e,containerPadding:n,containerWidth:o,cols:s}=t;return(o-e[0]*(s-1)-n[0]*2)/s}function z(t,e,n){return Number.isFinite(t)?Math.round(e*t+Math.max(0,t-1)*n):t}function O(t,e,n,o,s){const{margin:r,containerPadding:i,rowHeight:d}=t,l=T(t);return{width:z(o,l,r[0]),height:z(s,d,r[1]),top:Math.round((d+r[1])*n+i[1]),left:Math.round((l+r[0])*e+i[0])}}function St(t,e,n,o,s){const{margin:r,cols:i,rowHeight:d,maxRows:l}=t,f=T(t);let p=Math.round((n-r[0])/(f+r[0])),u=Math.round((e-r[1])/(d+r[1]));return p=M(p,0,i-o),u=M(u,0,l-s),{x:p,y:u}}function It(t,e,n,o,s,r){const{margin:i,maxRows:d,cols:l,rowHeight:f}=t,p=T(t);let u=Math.round((e+i[0])/(p+i[0])),x=Math.round((n+i[1])/(f+i[1])),h=M(u,0,l-o),g=M(x,0,d-s);return["sw","w","nw"].indexOf(r)!==-1&&(h=M(u,0,l)),["nw","n","ne"].indexOf(r)!==-1&&(g=M(x,0,d)),{w:h,h:g}}function M(t,e,n){return Math.max(Math.min(t,n),e)}const Y=794,V=1122,gt=10,pt=16;function mt({grid:t,dashboardTitle:e,timeRange:n,variableControls:o}){const[s,r]=(0,m.useState)(!1),{scaleFactor:i,isLandscape:d,isSimpleLayout:l,reportTitle:f,showTemplateVariables:p}=xt(),u=(0,D.$j)(),x=wt(u,i);yt(t.state.children);const{children:h}=t.useState(),[g,R]=(0,m.useState)(0),P=(0,m.useRef)(null);if(tt({ref:P,onResize:()=>{const b=P.current;b&&b.offsetHeight!==0&&R(b.offsetHeight)}}),(0,m.useEffect)(()=>(r(!0),(0,et.M6)(t)),[t]),!s)return null;let Pt=d?V:Y,Dt=d?Y:V;const C=Pt*i-2*pt,Z=(Dt-g-gt)*i;let H=[];return l?H=ht(h,i,Z,d):H=ft(h,i,Z),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{style:{width:C,visibility:"hidden",position:"absolute",top:0,left:0},children:(0,a.jsx)(E,{reportTitle:f||e,dashboardTitle:e,timeRange:n,scaleFactor:i,variableControls:o,showTemplateVariables:p,ref:P})}),(0,a.jsx)(a.Fragment,{children:H.map((b,A)=>(0,a.jsxs)("div",{className:x.page,children:[(0,a.jsxs)("div",{className:x.content,children:[(0,a.jsx)(E,{reportTitle:f||e,dashboardTitle:e,timeRange:n,scaleFactor:i,variableControls:o,showTemplateVariables:p}),(0,a.jsx)("div",{style:Rt(b,C),children:b.items.map((K,Ht)=>(0,a.jsx)("div",{style:vt(K,C),children:K.render()},Ht))})]},A),(0,a.jsx)(it,{scaleFactor:i,currentPage:A+1,totalPageCount:H.length}),b.pageBreakAfter&&(0,a.jsx)("div",{style:{pageBreakAfter:"always"}})]},A))})]})}function xt(){const t=(0,N.zy)(),e=new URLSearchParams(t.search),n=parseFloat(e.get("scale")??"");return{scaleFactor:isNaN(n)?1:n,isLandscape:e.get("pdf.landscape")!=="false",isSimpleLayout:e.get("pdf.layout")==="simple",reportTitle:e.get("title"),showTemplateVariables:e.get("pdf.showTemplateVariables")!==null&&e.get("pdf.showTemplateVariables")!=="false"}}function yt(t){for(const e of t)e instanceof v.tI&&e.state.isCollapsed&&e.onCollapseToggle()}function vt(t,e){const n=U(e),o=O(n,t.x,t.y,t.w,t.h);return{top:o.top,left:o.left,width:o.width,height:o.height,position:"absolute"}}function Rt(t,e){const n=U(e),o=O(n,0,0,w.cV,t.h);return{width:o.width,height:o.height,position:"relative"}}function wt(t,e){return{page:(0,y.css)({display:"flex",flexDirection:"column",justifyContent:"space-between",alignItems:"center",width:"100%",minHeight:"100vh","&:last-of-type":{marginBottom:t.spacing(2*-1)}}),content:(0,y.css)({flex:1})}}function F({route:t}){const e=(0,Q.sP)(),{dashboard:n,isLoading:o,loadError:s}=e.useState(),{uid:r=""}=(0,S.g)();return(0,m.useEffect)(()=>(e.loadDashboard({uid:r,route:q.DashboardRoutes.Report}),()=>{e.clearState()}),[e,r,t.routeName]),n?(0,a.jsx)(bt,{model:n}):(0,a.jsxs)("div",{children:[o&&(0,a.jsx)(J.A,{}),s&&(0,a.jsx)("h2",{children:s})]})}function bt({model:t}){const[e,n]=(0,m.useState)(!1),o=t.useState(),s=o.$timeRange.useState(),r=o.controls?.useState().variableControls,i=(0,D.of)(jt);if((0,m.useEffect)(()=>(n(!0),t.activate()),[t]),!e)return null;const d=o.body;return d instanceof k.D?(0,a.jsx)(v.$L,{scene:t,children:(0,a.jsx)("div",{className:i.canvas,children:(0,a.jsx)("div",{className:i.body,children:(0,a.jsx)(mt,{grid:d.state.grid,dashboardTitle:o.title,timeRange:s,variableControls:r})})})}):(0,a.jsx)(X.F,{title:"Unsupported dashboard layout",severity:"error"})}function jt(t){return{canvas:(0,y.css)({label:"canvas",display:"flex",flexDirection:"column",flexBasis:"100%",flexGrow:1,padding:"0 "+t.spacing(2)}),body:(0,y.css)({label:"body",flexGrow:1,display:"flex",gap:"8px",marginBottom:t.spacing(2)})}}const Mt=F},6089:(L,j,c)=>{c.d(j,{f:()=>y,g:()=>a});const a=m=>m?y(m)?"file":m.startsWith("http")||m.startsWith("data:")?"url":m.startsWith("#")||m.startsWith("rgb(")||m.startsWith("rgba(")?"color":"file":"url",y=m=>m instanceof File},77422:(L,j,c)=>{c.d(j,{A:()=>m,h:()=>S});var a=c(78011),y=c(6089);const m=v=>(0,y.f)(v)?URL.createObjectURL(v):(0,y.g)(v)==="file"?`${a.Sw}${v}`:v,S=v=>!v||v instanceof File?!0:typeof v=="string"&&v.startsWith("http")}}]);

//# sourceMappingURL=DashboardReportPage.6b9d5a2101f83139a7e1.js.map