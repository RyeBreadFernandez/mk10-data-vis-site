"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[829],{39184:(Ee,k,t)=>{t.d(k,{u:()=>R});var e=t(74848),o=t(32196),g=t(96540),p=t(40845),P=t(94753),m=t(42418),f=t(67061),E=t(90182),b=t(29158),w=t(79633),U=t(70383),Q=t(93667);const I=500,h=v=>new Promise(y=>setTimeout(y,v)),u=1e3,R=({selectProps:v,showRefreshButton:y,selectedContactPointName:V})=>{const{selectedAlertmanager:J}=(0,U.VI)(),{contactPoints:q,isLoading:G,error:D,refetch:S}=(0,Q.dK)({alertmanager:J}),[B,z]=(0,g.useState)(!1),re=(0,p.of)(j),Y=q.map(_=>({label:_.name,value:_,component:()=>(0,e.jsx)(P.E,{variant:"bodySmall",color:"secondary",children:(0,e.jsx)(w.yz,{receivers:_.grafana_managed_receiver_configs,limit:2})})})),X=(0,g.useMemo)(()=>Y.find(_=>_.value?.name===V)||null,[Y,V]),je=()=>{z(!0),Promise.all([S(),h(u)]).finally(()=>{z(!1)})};return D?(0,e.jsx)(m.F,{title:"Failed to fetch contact points",severity:"error"}):(0,e.jsxs)(f.B,{children:[(0,e.jsx)(E.l6,{virtualized:Y.length>I,options:Y,value:X,...v,isLoading:G}),y&&(0,e.jsx)(b.K,{name:"sync",onClick:je,"aria-label":"Refresh contact points",tooltip:"Refresh contact points list",className:(0,o.cx)(re.refreshButton,{[re.loading]:B||G})})]})},x=(0,o.keyframes)({from:{transform:"rotate(0deg)"},to:{transform:"rotate(720deg)"}}),j=v=>({refreshButton:(0,o.css)({color:v.colors.text.secondary,cursor:"pointer",borderRadius:v.shape.radius.circle,overflow:"hidden"}),loading:(0,o.css)({pointerEvents:"none",[v.transitions.handleMotion("no-preference")]:{animation:`${x} 2s infinite linear`},[v.transitions.handleMotion("reduce")]:{animation:`${x} 6s infinite linear`}})})},99226:(Ee,k,t)=>{t.d(k,{gv:()=>U});var e=t(74848),o=t(2543),g=t.n(o),p=t(32264),P=t(67061),m=t(55852),f=t(25968);const E=p.$.unifiedAlerting.minInterval??"10s",w=((Q=E)=>{const h=[(0,f.M9)("10s"),(0,f.M9)("30s"),(0,f.M9)("1m"),(0,f.M9)("5m"),(0,f.M9)("10m"),(0,f.M9)("15m"),(0,f.M9)("30m"),(0,f.M9)("1h")],u=(0,f.P8)(Q),R=h.filter(j=>u<=j),x=(0,o.times)(8-R.length,j=>{const v=(0,o.last)(R)??u,y=R.length===0?1:2;return v*y*(j+1)});return[...R,...x].map(f.an)})(E),U=({currentInterval:Q,onSelect:I})=>(0,e.jsx)(P.B,{direction:"row",gap:.5,role:"listbox",children:w.map(h=>{const u=Q===h;return(0,e.jsx)(m.$n,{role:"option","aria-selected":u,variant:u?"primary":"secondary",size:"sm",onClick:()=>I(h),children:h},h)})})},1723:(Ee,k,t)=>{t.d(k,{R:()=>ze,I:()=>Ge});var e=t(74848),o=t(32196),g=t(96540),p=t(49785),P=t(40845),m=t(67061),f=t(29158),E=t(88575),b=t(60029),w=t(10354),U=t(94753),Q=t(15292),I=t(56034),h=t(14578),u=t(8484),R=t(23662),x=t(25027),j=t(9518),v=t(61410),y=t(57220),V=t(25968),J=t(64047),q=t(46479),G=t(2543),D=t(26272),S=t(13544),B=t(55852),z=t(90182),re=t(90613),Y=t(37390),X=t(28138),je=t(16233),_=t(11230),ye=t(31678),Se=t(79938),Oe=t(77583),Ne=t(63066),Pe=t(48205),N=t(99226),C=t(85242);const T=()=>{const n=(0,P.of)(se),a=()=>window.open("https://github.com/grafana/grafana/issues/42947","_blank");return(0,e.jsxs)(m.B,{gap:.5,children:[(0,e.jsx)("div",{className:n.slashNotAllowed,children:"Folders with '/' character are not allowed."}),(0,e.jsx)(I.m,{placement:"top",content:"Link to the Github issue",theme:"info",children:(0,e.jsx)(h.I,{name:"info-circle",size:"xs",className:n.infoIcon,onClick:a})})]})},L=n=>n.indexOf("/")!==-1;function te(n){const{value:a}=n,l={warningCondition:i=>L(i),warningComponent:T},r={disallowValues:!0,isAllowedValue:i=>!L(i)};return(0,e.jsx)(C.sR,{showRoot:!1,rootName:"",allowEmpty:!0,initialFolderUid:a?.uid,searchQueryType:ye.SearchQueryType.AlertFolder,...n,permissionLevel:ye.PermissionLevelString.Edit,customAdd:r,folderWarning:l})}const se=n=>({slashNotAllowed:(0,o.css)({color:n.colors.warning.main,fontSize:"12px",marginBottom:"2px"}),infoIcon:(0,o.css)({color:n.colors.warning.main,fontSize:"12px",marginBottom:"2px",cursor:"pointer"})}),ee=1e3,K=(n,a)=>{const{isLoading:s,currentData:l}=Se.hK.endpoints.rulerNamespace.useQuery({namespace:n,rulerConfig:Oe.b},{skip:!n,refetchOnMountOrArgChange:!0});return{groupOptions:(0,g.useMemo)(()=>l?(Object.values(l).flat()??[]).map(d=>{const c=de(d);return{label:d.name,value:d.name,description:d.interval??Ne.T6,isDisabled:a?!1:c,isProvisioned:c}}).sort(Te):[],[l,a]),loading:s}},de=n=>n.rules.some(a=>(0,R.lT)(a)&&!!a.grafana_alert.provenance),Te=(n,a)=>n.label?.localeCompare(a.label??"")||0,Ae=(n,a)=>n.label?.toLowerCase().includes(a.toLowerCase());function Fe({groupfoldersForGrafana:n,enableProvisionedGroups:a}){const{formState:{errors:s},watch:l,setValue:r,control:i}=(0,p.xW)(),d=(0,P.of)(pe),c=l("folder"),M=l("group"),{groupOptions:O,loading:H}=K(c?.uid??"",a),[W,A]=(0,g.useState)(!1),[le,ae]=(0,g.useState)(!1),$=()=>A(!0),ce=()=>ae(!0),oe=F=>{fe(),r("folder",F),A(!1)},Ce=(F,ie)=>{r("group",F),r("evaluateEvery",ie),ae(!1)},fe=(0,g.useCallback)(()=>{r("group","")},[r]),he=(0,g.useCallback)(async F=>{const ie=F?O.filter(Me=>Ae(Me,F)):O;return(0,G.take)(ie,ee)},[O]),me=(0,g.useMemo)(()=>(0,G.debounce)(he,300,{leading:!0}),[he]),$e=M?{value:M,label:M}:void 0;return(0,e.jsxs)("div",{className:d.container,children:[(0,e.jsxs)(m.B,{alignItems:"center",children:[(0,e.jsx)(E.D,{label:(0,e.jsx)(b.J,{htmlFor:"folder",description:"Select a folder to store your rule.",children:"Folder"}),className:d.formInput,error:s.folder?.message,"data-testid":"folder-picker",children:(0,e.jsx)(m.B,{direction:"row",alignItems:"center",children:!W&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(p.xI,{render:({field:{ref:F,...ie}})=>(0,e.jsx)("div",{style:{width:420},children:(0,e.jsx)(te,{inputId:"folder",invalid:!!s.folder?.message,...ie,enableReset:!0,onChange:({title:Me,uid:xe})=>{ie.onChange({title:Me,uid:xe}),fe()}})}),name:"folder",rules:{required:{value:!0,message:"Select a folder"}}}),(0,e.jsx)(U.E,{color:"secondary",children:"or"}),(0,e.jsx)(B.$n,{onClick:$,type:"button",icon:"plus",fill:"outline",variant:"secondary",disabled:!je.TP.hasPermission(ye.AccessControlAction.FoldersCreate),"data-testid":S.Tp.components.AlertRules.newFolderButton,children:"New folder"})]})||(0,e.jsx)("div",{children:"Creating new folder..."})})}),W&&(0,e.jsx)(De,{onCreate:oe,onClose:()=>A(!1)})]}),W&&(0,e.jsx)(De,{onCreate:oe,onClose:()=>A(!1)}),(0,e.jsxs)(m.B,{alignItems:"center",children:[(0,e.jsx)("div",{style:{width:420},children:(0,e.jsx)(E.D,{label:"Evaluation group and interval","data-testid":"group-picker",description:"Define how often the alert rule is evaluated.",className:d.formInput,error:s.group?.message,invalid:!!s.group?.message,htmlFor:"group",children:(0,e.jsx)(p.xI,{render:({field:{ref:F,...ie},fieldState:Me})=>(0,e.jsx)(z.DW,{disabled:!c||H,inputId:"group",...ie,onChange:xe=>{ie.onChange(xe.label??"")},isLoading:H,invalid:!!c&&!M&&!!Me.error,loadOptions:me,cacheOptions:!0,loadingMessage:"Loading groups...",defaultValue:$e,defaultOptions:O,getOptionLabel:xe=>(0,e.jsxs)("div",{children:[(0,e.jsx)("span",{children:xe.label}),xe.isProvisioned&&(0,e.jsxs)(e.Fragment,{children:[" ",(0,e.jsx)(Pe.rS,{})]})]}),placeholder:"Select an evaluation group..."},(0,G.uniqueId)()),name:"group",control:i,rules:{required:{value:!0,message:"Must enter a group name"}}})})}),(0,e.jsxs)(re.a,{marginTop:4,gap:1,display:"flex",alignItems:"center",children:[(0,e.jsx)(U.E,{color:"secondary",children:"or"}),(0,e.jsx)(B.$n,{onClick:ce,type:"button",icon:"plus",fill:"outline",variant:"secondary",disabled:!c,"data-testid":S.Tp.components.AlertRules.newEvaluationGroupButton,children:"New evaluation group"})]}),le&&(0,e.jsx)(Be,{onCreate:Ce,onClose:()=>ae(!1),groupfoldersForGrafana:n})]})]})}function De({onClose:n,onCreate:a}){const s=(0,P.of)(pe),[l,r]=(0,g.useState)(""),i=async()=>{const c=await(0,_.vV)({title:l});if(!c.uid){X.A.emit(D.r1.alertError,["Folder could not be created"]);return}const M={title:c.title,uid:c.uid};a(M),X.A.emit(D.r1.alertSuccess,["Folder Created","OK"])},d=L(l);return(0,e.jsxs)(Y.a,{className:s.modal,isOpen:!0,title:"New folder",onDismiss:n,onClickBackdrop:n,children:[(0,e.jsx)("div",{className:s.modalTitle,children:"Create a new folder to store your rule"}),(0,e.jsxs)("form",{onSubmit:i,children:[(0,e.jsx)(E.D,{label:(0,e.jsx)(b.J,{htmlFor:"folder",children:"Folder name"}),error:"The folder name can't contain slashes",invalid:d,children:(0,e.jsx)(w.p,{"data-testid":S.Tp.components.AlertRules.newFolderNameField,autoFocus:!0,id:"folderName",placeholder:"Enter a name",value:l,onChange:c=>r(c.currentTarget.value),className:s.formInput})}),(0,e.jsxs)(Y.a.ButtonRow,{children:[(0,e.jsx)(B.$n,{variant:"secondary",type:"button",onClick:n,children:"Cancel"}),(0,e.jsx)(B.$n,{type:"submit",disabled:!l||d,"data-testid":S.Tp.components.AlertRules.newFolderNameCreateButton,children:"Create"})]})]})]})}function Be({onClose:n,onCreate:a,groupfoldersForGrafana:s}){const l=(0,P.of)(pe),r=()=>{a(oe("group"),oe("evaluateEvery"))},{watch:i}=(0,p.xW)(),d="eval-every-input",c="new-eval-group-name",[M,O]=i(["group","folder.title"]),H=(s&&s[O]?.find(me=>me.name===M)?.rules)??[],W=()=>{n()},A=(0,p.mN)({defaultValues:{group:"",evaluateEvery:Ne.T6},mode:"onChange",shouldFocusError:!0}),{register:le,handleSubmit:ae,formState:$,setValue:ce,getValues:oe,watch:Ce}=A,fe=Ce("evaluateEvery"),he=me=>{ce("evaluateEvery",me,{shouldValidate:!0})};return(0,e.jsxs)(Y.a,{className:l.modal,isOpen:!0,title:"New evaluation group",onDismiss:W,onClickBackdrop:W,children:[(0,e.jsx)("div",{className:l.modalTitle,children:"Create a new evaluation group to use for this alert rule."}),(0,e.jsx)(p.Op,{...A,children:(0,e.jsxs)("form",{onSubmit:ae(()=>r()),children:[(0,e.jsx)(E.D,{label:(0,e.jsx)(b.J,{htmlFor:c,description:"A group evaluates all its rules over the same evaluation interval.",children:"Evaluation group name"}),error:$.errors.group?.message,invalid:!!$.errors.group,children:(0,e.jsx)(w.p,{"data-testid":S.Tp.components.AlertRules.newEvaluationGroupName,className:l.formInput,autoFocus:!0,id:c,placeholder:"Enter a name",...le("group",{required:{value:!0,message:"Required."}})})}),(0,e.jsx)(E.D,{error:$.errors.evaluateEvery?.message,label:(0,e.jsx)(b.J,{htmlFor:d,description:"How often all rules in the group are evaluated.",children:"Evaluation interval"}),invalid:!!$.errors.evaluateEvery,children:(0,e.jsx)(w.p,{"data-testid":S.Tp.components.AlertRules.newEvaluationGroupInterval,className:l.formInput,id:d,placeholder:Ne.T6,...le("evaluateEvery",(0,q.iS)(H))})}),(0,e.jsx)(N.gv,{currentInterval:fe,onSelect:he}),(0,e.jsxs)(Y.a.ButtonRow,{children:[(0,e.jsx)(B.$n,{variant:"secondary",type:"button",onClick:W,children:"Cancel"}),(0,e.jsx)(B.$n,{type:"submit",disabled:!$.isValid,"data-testid":S.Tp.components.AlertRules.newEvaluationGroupCreate,children:"Create"})]})]})})]})}const pe=n=>({container:(0,o.css)({display:"flex",flexDirection:"column",alignItems:"baseline",maxWidth:`${n.breakpoints.values.lg}px`,justifyContent:"space-between"}),formInput:(0,o.css)({flexGrow:1}),modal:(0,o.css)({width:`${n.breakpoints.values.sm}px`}),modalTitle:(0,o.css)({color:n.colors.text.secondary,marginBottom:n.spacing(2)})});var ne=t(94822);const ge=[{value:ne.Q8.Alerting,label:"Alerting"},{value:ne.Q8.NoData,label:"No Data"},{value:ne.Q8.OK,label:"Normal"},{value:ne.Q8.Error,label:"Error"},{value:ne.Q8.KeepLast,label:"Keep Last State"}],ve=({includeNoData:n,includeError:a,...s})=>{const l=(0,g.useMemo)(()=>n?a?ge:ge.filter(r=>r.value!==ne.Q8.Error):ge.filter(r=>r.value!==ne.Q8.NoData),[n,a]);return(0,e.jsx)(z.l6,{options:l,...s})};var Z=t(19338);function Le(n){const a=(0,V.P8)(n);return[0,a*1,a*2,a*3,a*4,a*5].map(V.an)}function Ke({selectedPendingPeriod:n,groupEvaluationInterval:a,onSelect:s}){const l=i=>n===i,r=Le(a);return(0,e.jsx)(m.B,{direction:"row",gap:.5,role:"listbox",children:r.map(i=>(0,e.jsx)(B.$n,{role:"option","aria-selected":l(i),variant:l(i)?"primary":"secondary",size:"sm",onClick:()=>{s(i)},children:i==="0s"?"None":i},i))})}var We=t(271);const Ge=10,be=n=>({required:{value:!0,message:"Required."},validate:a=>{if(a==="0")return!0;try{const s=(0,V.M9)(a);if(s===0)return!0;try{const l=(0,V.M9)(n);return s>=l?!0:(0,u.t)("alert-rule-form.evaluation-behaviour-for.validation","Pending period must be greater than or equal to the evaluation interval.")}catch{return!0}}catch(s){return s instanceof Error?s.message:(0,u.t)("alert-rule-form.evaluation-behaviour-for.error-parsing","Failed to parse duration")}}}),Ie=(n,a)=>{const{groupOptions:s}=K(n,!1);return!(0,g.useCallback)(r=>s.some(i=>i.label===r),[s])(a)};function we({evaluateEvery:n,setEvaluateEvery:a,enableProvisionedGroups:s}){const l=(0,P.of)(Re),{watch:r,setValue:i,getValues:d}=(0,p.xW)(),[c,M]=(0,g.useState)(!1),[O,H,W]=r(["group","folder.uid","folder.title"]),le=(0,v.$)(F=>F.rulerRules)[y.hY],$=(0,j.dy)(y.hY).find(F=>F.uid===H),ce=$?.groups.find(F=>F.name===O),oe=Ie(H??"",O);(0,g.useEffect)(()=>{!oe&&ce?.interval&&a(ce.interval)},[a,oe,i,ce]);const Ce=(F=!1)=>{F||(0,x.fH)(x.le.leavingRuleGroupEdit),M(!1)},fe=()=>M(!0),he=le?.loading||oe||!H||!O,me={name:W,rulesSource:y.hY,groups:[]},$e={name:O,interval:n,rules:[],totals:{}};return(0,e.jsxs)("div",{children:[(0,e.jsx)(Fe,{groupfoldersForGrafana:le?.result,enableProvisionedGroups:s}),W&&c&&(0,e.jsx)(q.u5,{namespace:$??me,group:ce??$e,folderUid:H,onClose:()=>Ce(),intervalEditOnly:!0,hideFolder:!0}),W&&O&&(0,e.jsx)("div",{className:l.evaluationContainer,children:(0,e.jsx)(m.B,{direction:"column",gap:0,children:(0,e.jsx)("div",{className:l.marginTop,children:(0,e.jsx)(m.B,{direction:"column",gap:1,children:d("group")&&d("evaluateEvery")&&(0,e.jsxs)("span",{children:[(0,e.jsxs)(u.x6,{i18nKey:"alert-rule-form.evaluation-behaviour-group.text",values:{evaluateEvery:n},children:["All rules in the selected group are evaluated every ",{evaluateEvery:n},"."]}),!oe&&(0,e.jsx)(f.K,{name:"pen","aria-label":"Edit",disabled:he,onClick:fe})]})})})})})]})}function Ue({evaluateEvery:n}){const a=(0,P.of)(Re),{register:s,formState:{errors:l},setValue:r,watch:i}=(0,p.xW)(),d="eval-for-input",c=i("evaluateFor"),M=O=>{r("evaluateFor",O)};return(0,e.jsxs)(m.B,{direction:"column","justify-content":"flex-start","align-items":"flex-start",children:[(0,e.jsx)(E.D,{label:(0,e.jsx)(b.J,{htmlFor:d,description:'Period the threshold condition must be met to trigger the alert. Selecting "None" triggers the alert immediately once the condition is met.',children:(0,e.jsx)(u.x6,{i18nKey:"alert-rule-form.evaluation-behaviour.pending-period",children:"Pending period"})}),className:a.inlineField,error:l.evaluateFor?.message,invalid:l.evaluateFor?.message?!0:void 0,validationMessageHorizontalOverflow:!0,children:(0,e.jsx)(w.p,{id:d,width:8,...s("evaluateFor",be(n))})}),(0,e.jsx)(Ke,{selectedPendingPeriod:c,groupEvaluationInterval:n,onSelect:M})]})}function ue(){return(0,e.jsxs)(m.B,{direction:"row",gap:.5,alignItems:"center",children:[(0,e.jsx)(U.E,{variant:"bodySmall",color:"secondary",children:(0,e.jsx)(u.x6,{i18nKey:"alert-rule-form.evaluation-behaviour.info-help.text",children:"Define the alert behavior when the evaluation fails or the query returns no data."})}),(0,e.jsx)(Z.G,{contentText:"These settings can help mitigate temporary data source issues, preventing alerts from unintentionally firing due to lack of data, errors, or timeouts.",externalLink:"https://grafana.com/docs/grafana/latest/alerting/alerting-rules/create-grafana-managed-rule/#configure-no-data-and-error-handling",linkText:"Read more about this option",title:"Configure no data and error handling"})]})}function Ve(){return(0,e.jsxs)(m.B,{direction:"row",gap:.5,alignItems:"center",children:[(0,e.jsx)(U.E,{variant:"bodySmall",color:"secondary",children:(0,e.jsx)(u.x6,{i18nKey:"alert-rule-form.evaluation-behaviour.description.text",children:"Define how the alert rule is evaluated."})}),(0,e.jsx)(Z.G,{contentText:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("p",{children:(0,e.jsx)(u.x6,{i18nKey:"alert-rule-form.evaluation-behaviour-description1",children:"Evaluation groups are containers for evaluating alert and recording rules."})}),(0,e.jsx)("p",{children:(0,e.jsx)(u.x6,{i18nKey:"alert-rule-form.evaluation-behaviour-description2",children:"An evaluation group defines an evaluation interval - how often a rule is evaluated. Alert rules within the same evaluation group are evaluated over the same evaluation interval."})}),(0,e.jsx)("p",{children:(0,e.jsx)(u.x6,{i18nKey:"alert-rule-form.evaluation-behaviour-description3",children:"Pending period specifies how long the threshold condition must be met before the alert starts firing. This option helps prevent alerts from being triggered by temporary issues."})})]}),externalLink:"https://grafana.com/docs/grafana/latest/alerting/fundamentals/alert-rules/rule-evaluation/",linkText:"Read about evaluation and alert states",title:"Alert rule evaluation"})]})}function ze({evaluateEvery:n,setEvaluateEvery:a,existing:s,enableProvisionedGroups:l}){const r=(0,P.of)(Re),[i,d]=(0,g.useState)(!1),{watch:c,setValue:M}=(0,p.xW)(),O=c("isPaused"),H=c("type"),W=(0,R.Mu)(H);return(0,e.jsxs)(We.P,{stepNo:3,title:"Set evaluation behavior",description:Ve(),children:[(0,e.jsxs)(m.B,{direction:"column","justify-content":"flex-start","align-items":"flex-start",children:[(0,e.jsx)(we,{setEvaluateEvery:a,evaluateEvery:n,enableProvisionedGroups:l}),W&&(0,e.jsx)(Ue,{evaluateEvery:n}),s&&(0,e.jsx)(E.D,{htmlFor:"pause-alert-switch",children:(0,e.jsx)(p.xI,{render:()=>(0,e.jsxs)(m.B,{gap:1,direction:"row",alignItems:"center",children:[(0,e.jsx)(Q.d,{id:"pause-alert",onChange:A=>{M("isPaused",A.currentTarget.checked)},value:!!O}),(0,e.jsxs)("label",{htmlFor:"pause-alert",className:r.switchLabel,children:[(0,e.jsx)(u.x6,{i18nKey:"alert-rule-form.pause",children:"Pause evaluation"}),(0,e.jsx)(I.m,{placement:"top",content:"Turn on to pause evaluation for this alert rule.",theme:"info",children:(0,e.jsx)(h.I,{tabIndex:0,name:"info-circle",size:"sm",className:r.infoIcon})})]})]}),name:"isPaused"})})]}),W&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(J.e,{isCollapsed:!i,onToggle:A=>d(!A),text:"Configure no data and error handling"}),i&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(ue,{}),(0,e.jsx)(E.D,{htmlFor:"no-data-state-input",label:"Alert state if no data or all values are null",children:(0,e.jsx)(p.xI,{render:({field:{onChange:A,ref:le,...ae}})=>(0,e.jsx)(ve,{...ae,inputId:"no-data-state-input",width:42,includeNoData:!0,includeError:!1,onChange:$=>A($?.value)}),name:"noDataState"})}),(0,e.jsx)(E.D,{htmlFor:"exec-err-state-input",label:"Alert state if execution error or timeout",children:(0,e.jsx)(p.xI,{render:({field:{onChange:A,ref:le,...ae}})=>(0,e.jsx)(ve,{...ae,inputId:"exec-err-state-input",width:42,includeNoData:!1,includeError:!0,onChange:$=>A($?.value)}),name:"execErrState"})})]})]})]})}const Re=n=>({inlineField:(0,o.css)({marginBottom:0}),evaluateLabel:(0,o.css)({marginRight:n.spacing(1)}),evaluationContainer:(0,o.css)({color:n.colors.text.secondary,maxWidth:`${n.breakpoints.values.sm}px`,fontSize:n.typography.size.sm}),intervalChangedLabel:(0,o.css)({marginBottom:n.spacing(1)}),warningIcon:(0,o.css)({justifySelf:"center",marginRight:n.spacing(1),color:n.colors.warning.text}),infoIcon:(0,o.css)({marginLeft:"10px"}),warningMessage:(0,o.css)({color:n.colors.warning.text}),bold:(0,o.css)({fontWeight:"bold"}),alignInterval:(0,o.css)({marginTop:n.spacing(1),marginLeft:`-${n.spacing(1)}`}),marginTop:(0,o.css)({marginTop:n.spacing(1)}),switchLabel:(0,o.css)({color:n.colors.text.primary,cursor:"pointer",fontSize:n.typography.bodySmall.fontSize})})},46479:(Ee,k,t)=>{t.d(k,{u5:()=>Ne,iS:()=>Oe});var e=t(74848),o=t(32196),g=t(2543),p=t(96540),P=t(49785),m=t(39938),f=t(40845),E=t(37390),b=t(67061),w=t(88575),U=t(60029),Q=t(10354),I=t(55852),h=t(42418),u=t(3169),R=t(99140),x=t(30531),j=t(6833),v=t(26627),y=t(82775),V=t(57220),J=t(78742),q=t(63066),G=t(23662),D=t(25968),S=t(75591),B=t(32264);const z=()=>(0,e.jsxs)(h.F,{severity:"warning",title:"Global evaluation interval limit exceeded",children:["A minimum evaluation interval of ",(0,e.jsx)("strong",{children:B.$.unifiedAlerting.minInterval})," has been configured in Grafana.",(0,e.jsx)("br",{}),"Please contact the administrator to configure a lower interval."]});var re=t(99106),Y=t(99226),X=t(1723);const je=10;function _({message:N,error:C}){return C?(0,e.jsx)(m.E,{color:"red",icon:"exclamation-circle",text:"Error",tooltip:N}):(0,e.jsx)(m.E,{color:"orange",icon:"exclamation-triangle",text:"Unknown",tooltip:N})}const ye=N=>{try{const C=(0,D.M9)(N);return!(C<X.I*1e3||C%(X.I*1e3)!==0)}catch{return!1}},Se=({rulesWithoutRecordingRules:N})=>{const C=(0,f.of)(Pe),{watch:T}=(0,P.xW)(),L=T("groupInterval"),te=!L,se=N.slice().map((K,de)=>({id:de,data:(0,G.jg)(K,L)})).sort((K,de)=>(0,D.P8)(K.data.forDuration??"")-(0,D.P8)(de.data.forDuration??"")),ee=(0,p.useMemo)(()=>[{id:"alertName",label:"Alert",renderCell:({data:{alertName:K}})=>(0,e.jsx)(e.Fragment,{children:K}),size:"330px"},{id:"for",label:"Pending period",renderCell:({data:{forDuration:K}})=>(0,e.jsx)(e.Fragment,{children:K}),size:.5},{id:"numberEvaluations",label:"#Eval",renderCell:({data:{evaluationsToFire:K}})=>te?(0,e.jsx)(_,{message:"#Evaluations not available."}):ye(L)?K===0?(0,e.jsx)(_,{message:"Invalid 'For' value: it should be greater or equal to evaluation interval.",error:!0}):(0,e.jsx)(e.Fragment,{children:K}):(0,e.jsx)(_,{message:"Invalid evaluation interval format",error:!0}),size:.4}],[L,te]);return(0,e.jsx)("div",{className:C.tableWrapper,children:(0,e.jsx)(S.E,{items:se,cols:ee,pagination:{itemsPerPage:je}})})},Oe=N=>({required:{value:!0,message:"Required."},validate:C=>{try{const T=(0,D.M9)(C);if(T<X.I*1e3)return`Cannot be less than ${X.I} seconds.`;if(T%(X.I*1e3)!==0)return`Must be a multiple of ${X.I} seconds.`;if((0,v.uQ)(N,C).length===0)return!0;{const L=N.map(se=>{const{forDuration:ee}=(0,G.jg)(se,C);return ee?(0,D.P8)(ee):null}),te=Math.min(...L.filter(se=>se!==null));return`Evaluation interval should be smaller or equal to "pending period" values for existing rules in this rule group. Choose a value smaller than or equal to "${(0,D.an)(te)}".`}}catch(T){return T instanceof Error?T.message:"Failed to parse duration"}}});function Ne(N){const{namespace:C,group:T,onClose:L,intervalEditOnly:te,folderUid:se}=N,ee=(0,f.of)(Pe),K=(0,u._2)(),[de,Te]=(0,x.iG)(),[Ae,Fe]=(0,x.xt)(),[De,Be]=(0,x.Ot)(),{loading:pe,error:ne}=(0,j.Gz)(Te,Be,Fe),ge=(0,p.useMemo)(()=>({namespaceName:(0,re.EL)(C).name,groupName:T.name,groupInterval:T.interval??q.T6}),[C,T.name,T.interval]),ve=(0,V.EV)(C.rulesSource),Z=ve===V.hY,Le=(0,re.EL)(C).parents,Ke=Z?"Folder":"Namespace",We=async r=>{const i={dataSourceName:ve,groupName:T.name,namespaceName:Z?se:C.name},d=Z?(0,re.wf)(r.namespaceName,Le):r.namespaceName,c=r.groupName,M=r.groupInterval,O=Z?!1:d!==i.namespaceName,H=c!==i.groupName;try{O?await De.execute(i,d,c,M):H?await Ae.execute(i,c,M):await de.execute(i,M),L(!0),await(0,R.JD)((0,v.eB)({rulesSourceName:ve}))}catch{}},Ge=(0,P.mN)({mode:"onBlur",defaultValues:ge,shouldFocusError:!0}),{handleSubmit:be,register:Ie,watch:we,formState:{isDirty:Ue,errors:ue,isValid:Ve},setValue:ze,getValues:Re}=Ge,n=()=>{K.error("There are errors in the form. Correct the errors and retry.")},a=(0,g.compact)(T.rules.map(r=>r.rulerRule).filter(r=>!(0,G.UL)(r))),s=a.length>0,l=te||Z?"Edit evaluation group":"Edit namespace or evaluation group";return(0,e.jsx)(E.a,{className:ee.modal,isOpen:!0,title:l,onDismiss:L,onClickBackdrop:L,children:(0,e.jsx)(P.Op,{...Ge,children:(0,e.jsx)("form",{onSubmit:be(We,n),children:(0,e.jsxs)(e.Fragment,{children:[!N.hideFolder&&(0,e.jsxs)(b.B,{gap:1,alignItems:"center",children:[(0,e.jsx)(w.D,{className:ee.formInput,label:(0,e.jsx)(U.J,{htmlFor:"namespaceName",description:!Z&&"Change the current namespace name. Moving groups between namespaces is not supported",children:Ke}),invalid:ue.namespaceName?!0:void 0,error:ue.namespaceName?.message,children:(0,e.jsx)(Q.p,{id:"namespaceName",readOnly:te||Z,...Ie("namespaceName",{required:"Namespace name is required."})})}),Z&&N.folderUrl&&(0,e.jsx)(I.z9,{href:N.folderUrl,title:"Go to folder",variant:"secondary",icon:"folder-open",target:"_blank"})]}),(0,e.jsx)(w.D,{label:(0,e.jsx)(U.J,{htmlFor:"groupName",description:"A group evaluates all its rules over the same evaluation interval.",children:"Evaluation group"}),invalid:!!ue.groupName,error:ue.groupName?.message,children:(0,e.jsx)(Q.p,{autoFocus:!0,id:"groupName",readOnly:te,...Ie("groupName",{required:"Evaluation group name is required."})})}),(0,e.jsx)(w.D,{label:(0,e.jsx)(U.J,{htmlFor:"groupInterval",description:"How often is the rule evaluated. Applies to every rule within the group.",children:(0,e.jsx)(b.B,{gap:.5,children:"Evaluation interval"})}),invalid:ue.groupInterval?!0:void 0,error:ue.groupInterval?.message,children:(0,e.jsxs)(b.B,{direction:"column",children:[(0,e.jsx)(Q.p,{id:"groupInterval",placeholder:q.T6,...Ie("groupInterval",Oe(a))}),(0,e.jsx)(Y.gv,{currentInterval:Re("groupInterval"),onSelect:r=>ze("groupInterval",r,{shouldValidate:!0,shouldDirty:!0})})]})}),Z&&(0,y.q)(we("groupInterval")).exceedsLimit&&(0,e.jsx)(z,{}),!s&&(0,e.jsx)("div",{children:"This group does not contain alert rules."}),s&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{children:"List of rules that belong to this group"}),(0,e.jsx)("div",{className:ee.evalRequiredLabel,children:"#Eval column represents the number of evaluations needed before alert starts firing."}),(0,e.jsx)(Se,{rulesWithoutRecordingRules:a})]}),ne&&(0,e.jsx)(h.F,{title:"Failed to update rule group",children:(0,J.JZ)(ne)}),(0,e.jsx)("div",{className:ee.modalButtons,children:(0,e.jsxs)(E.a.ButtonRow,{children:[(0,e.jsx)(I.$n,{variant:"secondary",type:"button",disabled:pe,onClick:()=>L(!1),fill:"outline",children:"Cancel"}),(0,e.jsx)(I.$n,{type:"submit",disabled:!Ue||!Ve||pe,children:pe?"Saving...":"Save"})]})})]})},JSON.stringify(ge))})})}const Pe=N=>({modal:(0,o.css)({maxWidth:"560px"}),modalButtons:(0,o.css)({top:"-24px",position:"relative"}),formInput:(0,o.css)({flex:1}),tableWrapper:(0,o.css)({marginTop:N.spacing(2),marginBottom:N.spacing(2),height:"100%"}),evalRequiredLabel:(0,o.css)({fontSize:N.typography.bodySmall.fontSize})})},30531:(Ee,k,t)=>{t.d(k,{Ot:()=>w,iG:()=>b,ts:()=>Q,xt:()=>U});var e=t(8484),o=t(79938),g=t(53270),p=t(48070),P=t(57220),m=t(6833),f=t(43482);const E=()=>(0,e.t)("alerting.rule-groups.update.success","Successfully updated rule group");function b(){const[I]=(0,f.D)(),[h]=o.hK.endpoints.upsertRuleGroupForNamespace.useMutation();return(0,m.Yb)(async(u,R)=>{const{namespaceName:x}=u,j=(0,p.lF)({interval:R}),{newRuleGroupDefinition:v,rulerConfig:y}=await I(u,j);return h({rulerConfig:y,namespace:x,payload:v,notificationOptions:{successMessage:E()}}).unwrap()})}function w(){const[I]=(0,f.D)(),[h]=o.hK.endpoints.getRuleGroupForNamespace.useLazyQuery(),[u]=o.hK.endpoints.upsertRuleGroupForNamespace.useMutation(),[R]=o.hK.endpoints.deleteRuleGroupFromNamespace.useMutation(),x=(0,e.t)("alerting.rule-groups.move.success","Successfully moved rule group");return(0,m.Yb)(async(j,v,y,V)=>{if((0,P.z2)(j.dataSourceName))throw new Error("Moving a Grafana-managed rule group to another folder is currently not supported.");const J=(0,p.fO)({newNamespaceName:v,groupName:y,interval:V}),{newRuleGroupDefinition:q,rulerConfig:G}=await I(j,J),D=j.namespaceName,S=J.payload.newNamespaceName,B=j.groupName,z=J.payload.groupName;if(z&&(!!z&&B!==z)&&(await h({rulerConfig:G,namespace:S,group:z,notificationOptions:{showErrorAlert:!1}}).unwrap().catch(g.R))?.rules?.length)throw new Error("Target group already has rules, merging rule groups is currently not supported.");return await u({rulerConfig:G,namespace:S,payload:q,notificationOptions:{successMessage:x}}).unwrap(),await R({rulerConfig:G,namespace:D,group:B,notificationOptions:{showSuccessAlert:!1}}).unwrap()})}function U(){const[I]=(0,f.D)(),[h]=o.hK.endpoints.getRuleGroupForNamespace.useLazyQuery(),[u]=o.hK.endpoints.upsertRuleGroupForNamespace.useMutation(),[R]=o.hK.endpoints.deleteRuleGroupFromNamespace.useMutation();return(0,m.Yb)(async(x,j,v)=>{const y=(0,p.KL)({groupName:j,interval:v}),{newRuleGroupDefinition:V,rulerConfig:J}=await I(x,y),q=x.groupName,G=y.payload.groupName,D=x.namespaceName,S=(0,e.t)("alerting.rule-groups.rename.success","Successfully renamed rule group");if((await h({rulerConfig:J,namespace:D,group:G,notificationOptions:{showErrorAlert:!1}}).unwrap().catch(g.R))?.rules?.length)throw new Error("Target group has existing rules, merging rule groups is currently not supported.");const z=await u({rulerConfig:J,namespace:D,payload:V,notificationOptions:{successMessage:S}}).unwrap();return await R({rulerConfig:J,namespace:D,group:q,notificationOptions:{showSuccessAlert:!1}}).unwrap(),z})}function Q(){const[I]=(0,f.D)(),[h]=o.hK.endpoints.upsertRuleGroupForNamespace.useMutation();return(0,m.Yb)(async(u,R)=>{const{namespaceName:x}=u,j=(0,p.bw)({swaps:R}),{newRuleGroupDefinition:v,rulerConfig:y}=await I(u,j);return h({rulerConfig:y,namespace:x,payload:v,notificationOptions:{successMessage:E()}}).unwrap()})}},41520:(Ee,k,t)=>{t.d(k,{V:()=>g});var e=t(96540),o=t(75471);function g(){return(0,e.useMemo)(()=>(0,o.Q9)(),[])}}}]);

//# sourceMappingURL=829.ba8470149e1192fd7052.js.map