"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[1036],{31084:(N,O,e)=>{e.d(O,{Y:()=>D});var a=e(74848),R=e(96540),c=e(41053),m=e(10096),T=e(31678),f=e(37425),A=e(85927);const D=({teamId:o,roleOptions:n,disabled:u,roles:l,onApplyRoles:_,pendingRoles:v,apply:p=!1,maxWidth:y,width:L,isLoading:W})=>{const[{loading:M,value:E=l||[]},P]=(0,c.A)(async()=>{try{if(l)return l;if(p&&v?.length)return v;if(m.TP.hasPermission(T.AccessControlAction.ActionTeamsRolesList)&&o>0)return await(0,A.xN)(o)}catch(s){console.error("Error loading options",s)}return[]},[o,v,l]);(0,R.useEffect)(()=>{P()},[P]);const j=async s=>{p?_&&_(s):(await(0,A.G3)(s,o),await P())},t=m.TP.hasPermission(T.AccessControlAction.ActionTeamsRolesAdd)&&m.TP.hasPermission(T.AccessControlAction.ActionTeamsRolesRemove);return(0,a.jsx)(f.n,{apply:p,onRolesChange:j,roleOptions:n,appliedRoles:E,isLoading:M||W,disabled:u,basicRoleDisabled:!0,canUpdateRoles:t,maxWidth:y,width:L})}},52576:(N,O,e)=>{e.r(O),e.d(O,{TeamList:()=>r,default:()=>B});var a=e(74848),R=e(32196),c=e(96540),m=e(70255),T=e(71468),f=e(40845),A=e(12942),D=e(72109),o=e(67061),n=e(55852),u=e(91605),l=e(69529),_=e(14186),v=e(67647),p=e(48840),y=e(19384),L=e(21780),W=e(85927),M=e(8484),E=e(16233),P=e(31678),j=e(31084),t=e(33667);const s=new Array(3).fill(null).map((d,U)=>({id:U,uid:"",memberCount:0,name:"",orgId:0,permission:0})),r=({teams:d,query:U,noTeams:I,hasFetched:h,loadTeams:b,deleteTeam:Q,changeQuery:X,totalPages:Z,page:F,rolesLoading:V,changePage:w,changeSort:k})=>{const[J,q]=(0,c.useState)([]),K=(0,f.of)(S);(0,c.useEffect)(()=>{b(!0)},[b]),(0,c.useEffect)(()=>{E.TP.licensedAccessControlEnabled()&&E.TP.hasPermission(P.AccessControlAction.ActionRolesList)&&(0,W.RL)().then(i=>q(i))},[]);const z=E.TP.hasPermission(P.AccessControlAction.ActionTeamsCreate),H=g(),ee=(0,c.useMemo)(()=>[{id:"avatarUrl",header:"",disableGrow:!0,cell:({cell:{value:i}})=>h?i&&(0,a.jsx)(A.e,{src:i,alt:"User avatar"}):(0,a.jsx)(m.A,{containerClassName:K.blockSkeleton,width:24,height:24,circle:!0})},{id:"name",header:"Name",cell:({cell:{value:i},row:{original:C}})=>h?E.TP.hasPermissionInMetadata(P.AccessControlAction.ActionTeamsRead,C)?(0,a.jsx)(D.Y,{color:"primary",inline:!1,href:`/org/teams/edit/${C.uid}`,title:"Edit team",children:i}):i:(0,a.jsx)(m.A,{width:100}),sortType:"string"},{id:"email",header:"Email",cell:({cell:{value:i}})=>h?i:(0,a.jsx)(m.A,{width:60}),sortType:"string"},{id:"memberCount",header:"Members",disableGrow:!0,cell:({cell:{value:i}})=>h?i:(0,a.jsx)(m.A,{width:40}),sortType:"number"},...H?[{id:"role",header:"Role",cell:({cell:{value:i},row:{original:C}})=>h?E.TP.hasPermissionInMetadata(P.AccessControlAction.ActionTeamsRolesList,C)&&(0,a.jsx)(j.Y,{teamId:C.id,roles:C.roles||[],isLoading:V,roleOptions:J,width:40}):(0,a.jsx)(m.A,{width:320,height:32,containerClassName:K.blockSkeleton})}]:[],{id:"actions",header:"",disableGrow:!0,cell:({row:{original:i}})=>{if(!h)return(0,a.jsxs)(o.B,{direction:"row",justifyContent:"flex-end",alignItems:"center",children:[(0,a.jsx)(m.A,{containerClassName:K.blockSkeleton,width:16,height:16}),(0,a.jsx)(m.A,{containerClassName:K.blockSkeleton,width:22,height:24})]});const C=E.TP.hasPermissionInMetadata(P.AccessControlAction.ActionTeamsRead,i),G=E.TP.hasPermissionInMetadata(P.AccessControlAction.ActionTeamsDelete,i);return(0,a.jsxs)(o.B,{direction:"row",justifyContent:"flex-end",gap:2,children:[C&&(0,a.jsx)(n.z9,{href:`org/teams/edit/${i.uid}`,"aria-label":`Edit team ${i.name}`,icon:"pen",size:"sm",variant:"secondary",tooltip:"Edit team"}),(0,a.jsx)(u.e,{"aria-label":`Delete team ${i.name}`,size:"sm",disabled:!G,onConfirm:()=>Q(i.uid)})]})}}],[H,h,V,J,Q,K]);return(0,a.jsx)(L.YW,{navId:"teams",actions:I?void 0:(0,a.jsx)(n.z9,{href:z?"org/teams/new":"#",disabled:!z,children:"New Team"}),children:(0,a.jsx)(L.YW.Contents,{children:I?(0,a.jsx)(l.p,{variant:"call-to-action",button:(0,a.jsx)(n.z9,{disabled:!z,href:"org/teams/new",icon:"users-alt",size:"lg",children:(0,a.jsx)(M.x6,{i18nKey:"teams.empty-state.button-title",children:"New team"})}),message:(0,M.t)("teams.empty-state.title","You haven't created any teams yet"),children:(0,a.jsxs)(M.x6,{i18nKey:"teams.empty-state.pro-tip",children:["Assign folder and dashboard permissions to teams instead of users to ease administration."," ",(0,a.jsx)(D.Y,{external:!0,href:"https://grafana.com/docs/grafana/latest/administration/team-management",children:"Learn more"})]})}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"page-action-bar",children:(0,a.jsx)(_.I,{grow:!0,children:(0,a.jsx)(v.Z,{placeholder:"Search teams",value:U,onChange:X})})}),h&&d.length===0?(0,a.jsx)(l.p,{variant:"not-found",message:(0,M.t)("teams.empty-state.message","No teams found")}):(0,a.jsxs)(o.B,{direction:"column",gap:2,children:[(0,a.jsx)(p.j,{columns:ee,data:h?d:s,getRowId:i=>String(i.id),fetchData:k}),(0,a.jsx)(o.B,{justifyContent:"flex-end",children:(0,a.jsx)(y.d,{hideWhenSinglePage:!0,currentPage:F,numberOfPages:Z,onNavigate:w})})]})]})})})};function g(){return E.TP.licensedAccessControlEnabled()&&E.TP.hasPermission(P.AccessControlAction.ActionTeamsRolesList)&&E.TP.hasPermission(P.AccessControlAction.ActionRolesList)}function x(d){return{teams:d.teams.teams,query:d.teams.query,perPage:d.teams.perPage,page:d.teams.page,noTeams:d.teams.noTeams,totalPages:d.teams.totalPages,hasFetched:d.teams.hasFetched,rolesLoading:d.teams.rolesLoading}}const $={loadTeams:t.Bu,deleteTeam:t.To,changePage:t.yd,changeQuery:t.nM,changeSort:t.Vk},B=(0,T.connect)(x,$)(r),S=d=>({blockSkeleton:(0,R.css)({lineHeight:1,display:"flex"})})},33667:(N,O,e)=>{e.d(O,{Bu:()=>n,It:()=>E,To:()=>_,Vk:()=>y,aK:()=>M,eo:()=>l,n7:()=>W,nC:()=>P,nM:()=>v,yd:()=>p});var a=e(2543),R=e.n(a),c=e(17172),m=e(82467),T=e(10096),f=e(80714),A=e(31678),D=e(78319),o=e(34655);function n(t=!1){return async(s,r)=>{const{query:g,page:x,perPage:$,sort:Y}=r().teams;if(!T.TP.hasPermission(A.AccessControlAction.ActionTeamsRead)){s((0,o.Q9)({teams:[],totalCount:0,page:1,perPage:$,noTeams:!0}));return}const B=await(0,c.AI)().get("/api/teams/search",(0,f.F)({query:g,page:x,perpage:$,sort:Y}));let S=!1;if(t&&(S=B.teams.length===0),T.TP.licensedAccessControlEnabled()&&T.TP.hasPermission(A.AccessControlAction.ActionTeamsRolesList)){s((0,o.dJ)());const d=B?.teams.map(I=>I.id),U=await(0,c.AI)().post("/api/access-control/teams/roles/search",{teamIds:d});B.teams.forEach(I=>{I.roles=U?U[I.id]||[]:[]}),s((0,o.jE)())}s((0,o.Q9)({noTeams:S,...B}))}}const u=(0,a.debounce)(t=>t(n()),500);function l(t){return async s=>{const r=await(0,c.AI)().get(`/api/teams/${t}`,(0,f.F)());s((0,o.$T)(r)),s((0,m.Vz)((0,D.R)(r)))}}function _(t){return async s=>{await(0,c.AI)().delete(`/api/teams/${t}`),await T.TP.fetchUserPermissions(),s(n())}}function v(t){return async s=>{s((0,o.L5)(t)),u(s)}}function p(t){return async s=>{s((0,o.EC)(t)),s(n())}}function y({sortBy:t}){const s=t.length?`${t[0].id}-${t[0].desc?"desc":"asc"}`:void 0;return async r=>{r((0,o.$u)(s)),r(n())}}function L(){return async(t,s)=>{const r=s().team.team,g=await getBackendSrv().get(`/api/teams/${r.uid}/members`);t(teamMembersLoaded(g))}}function W(t,s){return async(r,g)=>{const x=g().team.team;await(0,c.AI)().put(`/api/teams/${x.uid}`,{name:t,email:s}),r(l(x.uid))}}function M(){return async(t,s)=>{const r=s().team.team,g=await(0,c.AI)().get(`/api/teams/${r.id}/groups`);t((0,o.tC)(g))}}function E(t){return async(s,r)=>{const g=r().team.team;await(0,c.AI)().post(`/api/teams/${g.id}/groups`,{groupId:t}),s(M())}}function P(t){return async(s,r)=>{const g=r().team.team;await(0,c.AI)().delete(`/api/teams/${g.id}/groups?groupId=${encodeURIComponent(t)}`),s(M())}}function j(t){return async s=>{await getBackendSrv().put(`/api/teams/${t.teamId}/members/${t.userId}`,{permission:t.permission}),s(L())}}},78319:(N,O,e)=>{e.d(O,{R:()=>D,X:()=>o});var a=e(33378),R=e(76323),c=e(2913),m=e(16233),T=e(35538),f=e(31678);const A={avatarUrl:"public/img/user_profile.png",id:1,uid:"",name:"Loading",email:"loading",memberCount:0,permission:f.TeamPermissionLevel.Member,accessControl:{isEditor:!1},orgId:0,updated:""};function D(n){const u={img:n.avatarUrl,id:"team-"+n.uid,subTitle:"Manage members and settings",url:`org/teams/edit/${n.uid}`,text:n.name,children:[{active:!1,icon:"sliders-v-alt",id:`team-settings-${n.uid}`,text:"Settings",url:`org/teams/edit/${n.uid}/settings`}]};(n===A||m.TP.hasPermissionInMetadata(f.AccessControlAction.ActionTeamsPermissionsRead,n))&&u.children.unshift({active:!1,icon:"users-alt",id:`team-members-${n.uid}`,text:"Members",url:`org/teams/edit/${n.uid}/members`});const l={active:!1,icon:"sync",id:`team-groupsync-${n.uid}`,text:"External group sync",url:`org/teams/edit/${n.uid}/groupsync`},_=n===A;return(0,T.z5)()&&(l.tabSuffix=()=>(0,R.J)({experimentId:_?"":"feature-highlights-team-sync-badge",eventVariant:"trial"})),(0,a.a)("teamsync")?(_||m.TP.hasPermissionInMetadata(f.AccessControlAction.ActionTeamsPermissionsRead,n))&&u.children.push(l):c.Ay.featureToggles.featureHighlights&&u.children.push({...l,tabSuffix:()=>(0,R.J)({experimentId:_?"":"feature-highlights-team-sync-badge"})}),u}function o(n){const u=D(A);let l;for(const _ of u.children)if(_.id.indexOf(n)>0){_.active=!0,l=_;break}return{main:u,node:l}}}}]);

//# sourceMappingURL=TeamList.bcdaa31600ce341db757.js.map