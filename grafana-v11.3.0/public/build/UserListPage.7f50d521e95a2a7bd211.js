"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[1743],{89062:(k,D,a)=>{a.d(D,{y:()=>O});var s=a(74848),i=a(96540),v=a(41053),j=a(10096),x=a(31678),m=a(37425),g=a(85927);const O=({basicRole:l,roles:f,userId:P,orgId:b,onBasicRoleChange:E,roleOptions:I,disabled:Z,basicRoleDisabled:Q,basicRoleDisabledMessage:L,apply:y=!1,onApplyRoles:R,pendingRoles:A,maxWidth:F,width:G,isLoading:H})=>{const[{loading:J,value:B=f||[]},p]=(0,v.A)(async()=>{try{if(f)return f;if(y&&A?.length)return A;if(j.TP.hasPermission(x.AccessControlAction.ActionUserRolesList)&&P>0)return await(0,g.Xh)(P,b)}catch{console.error("Error loading options")}return[]},[b,P,A,f]);(0,i.useEffect)(()=>{b&&p()},[p,b]);const K=async W=>{y?R&&R(W,P,b):(await(0,g.eA)(W,P,b),await p())},N=j.TP.hasPermission(x.AccessControlAction.ActionUserRolesAdd)&&j.TP.hasPermission(x.AccessControlAction.ActionUserRolesRemove);return(0,s.jsx)(m.n,{appliedRoles:B,basicRole:l,onRolesChange:K,onBasicRoleChange:E,roleOptions:I,isLoading:J||H,disabled:Z,basicRoleDisabled:Q,basicRoleDisabledMessage:L,showBasicRole:!0,apply:y,canUpdateRoles:N,maxWidth:F,width:G})}},5133:(k,D,a)=>{a.d(D,{r:()=>m});var s=a(74848),i=a(62625),v=a(90182);const x=Object.values(i.X).filter(g=>g!==i.X.None).map(g=>({label:g,value:g}));function m({value:g,onChange:O,"aria-label":l,inputId:f,autoFocus:P,...b}){return(0,s.jsx)(v.l6,{inputId:f,value:g,options:x,onChange:E=>O(E.value??i.X.None),placeholder:"Choose role...","aria-label":l,autoFocus:P,...b})}},65551:(k,D,a)=>{a.r(D),a.d(D,{default:()=>ne});var s=a(74848),i=a(32196),v=a(96540),j=a(13544),x=a(32264),m=a(40675),g=a(40845),O=a(63021),l=a(8484),f=a(16233),P=a(72254),b=a(21780),E=a(31678),I=a(71468),Z=a(36663),Q=a(42418),L=a(10096),y=a(69546),R=a(10534),A=a(55852),F=a(47259);const G={revokeInvite:F.eb},H=(0,I.connect)(null,G);class J extends v.PureComponent{render(){const{invitee:n,revokeInvite:t}=this.props;return(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{children:n.email}),(0,s.jsx)("td",{children:n.name}),(0,s.jsxs)("td",{className:"text-right",children:[(0,s.jsx)(R.b,{icon:"copy",variant:"secondary",size:"sm",getText:()=>n.url,children:"Copy Invite"}),"\xA0"]}),(0,s.jsx)("td",{children:(0,s.jsx)(A.$n,{variant:"destructive",size:"sm",icon:"times",onClick:()=>t(n.code),"aria-label":"Revoke Invite"})})]})}}const B=H(J);class p extends v.PureComponent{render(){const{invitees:n}=this.props;return(0,s.jsxs)("table",{className:"filter-table form-inline",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"Email"}),(0,s.jsx)("th",{children:"Name"}),(0,s.jsx)("th",{}),(0,s.jsx)("th",{style:{width:"34px"}})]})}),(0,s.jsx)("tbody",{"data-testid":"InviteesTable-body",children:n.map((t,o)=>(0,s.jsx)(B,{invitee:t},`${t.id}-${o}`))})]})}}var K=a(25508),N=a(40823);const{selectAll:W,selectById:xs,selectTotal:ss}=N.Tp,es=(e,n)=>n,as=(0,K.Mz)([W,es],(e,n)=>{const t=new RegExp(n,"i");return e.filter(c=>t.test(c.name)||t.test(c.email))});var _=a(14186),$=a(67647),Y=a(94354),V=a(2913),ns=a(2543),X=a(17172),r=a(80714),h=a(87617);function C(){return async(e,n)=>{try{e((0,h.Cj)());const{perPage:t,page:o,searchQuery:c,sort:u}=n().users,U=await(0,X.AI)().get("/api/org/users/search",(0,r.F)({perpage:t,page:o,query:c,sort:u}));if(L.TP.licensedAccessControlEnabled()&&L.TP.hasPermission(E.AccessControlAction.ActionUserRolesList)){e((0,h.dJ)());const d=L.TP.user.orgId,M=U?.orgUsers.map(T=>T.userId),S=await(0,X.AI)().post("/api/access-control/users/roles/search",{userIds:M,orgId:d});U.orgUsers.forEach(T=>{T.roles=S?S[T.userId]||[]:[]}),e((0,h.jE)())}e((0,h.Y_)(U))}catch{(0,h.g4)()}}}const ts=(0,ns.debounce)(e=>e(C()),300);function z(e){return async n=>{await(0,X.AI)().patch(`/api/org/users/${e.userId}`,{role:e.role}),n(C())}}function rs(e){return async n=>{await(0,X.AI)().delete(`/api/org/users/${e}`),n(C())}}function os(e){return async n=>{n((0,h.EC)(e)),n(C())}}function fs({sortBy:e}){const n=e.length?`${e[0].id}-${e[0].desc?"desc":"asc"}`:void 0;return async t=>{t((0,h.$u)(n)),t(C())}}function ys(e){return async n=>{n((0,h.t_)(e)),ts(n)}}const Us=e=>{const n=new RegExp(e.searchQuery,"i");return e.users.filter(t=>n.test(t.login)||n.test(t.email)||n.test(t.name))},is=e=>e.searchQuery;function Ds(e){return{searchQuery:is(e.users),pendingInvitesCount:ss(e.invites),externalUserMngLinkName:e.users.externalUserMngLinkName,externalUserMngLinkUrl:e.users.externalUserMngLinkUrl}}const Es={changeSearchQuery:ys},Ts=(0,I.connect)(Ds,Es)(({externalUserMngLinkName:e,externalUserMngLinkUrl:n,searchQuery:t,pendingInvitesCount:o,changeSearchQuery:c,onShowInvites:u,showInvites:U})=>{const d=[{label:"Users",value:"users"},{label:`Pending Invites (${o})`,value:"invites"}],S=L.TP.hasPermission(E.AccessControlAction.OrgUsersAdd)&&!(V.Ay.disableLoginForm&&V.Ay.externalUserMngInfo);return(0,s.jsxs)("div",{className:"page-action-bar","data-testid":"users-action-bar",children:[(0,s.jsx)(_.I,{grow:!0,children:(0,s.jsx)($.Z,{value:t,onChange:c,placeholder:"Search user by login, email or name"})}),o>0&&(0,s.jsx)("div",{style:{marginLeft:"1rem"},children:(0,s.jsx)(Y.z,{value:U?"invites":"users",options:d,onChange:u})}),S&&(0,s.jsx)(A.z9,{href:"org/users/invite",children:"Invite"}),n&&(0,s.jsx)(A.z9,{href:n,target:"_blank",rel:"noopener",children:e})]})});function Ls(e){const n=is(e.users);return{users:Us(e.users),searchQuery:is(e.users),page:e.users.page,totalPages:e.users.totalPages,perPage:e.users.perPage,invitees:as(e.invites,n),externalUserMngInfo:e.users.externalUserMngInfo,isLoading:e.users.isLoading,rolesLoading:e.users.rolesLoading}}const Cs={loadUsers:C,fetchInvitees:F.G7,changePage:os,changeSort:fs,updateUser:z,removeUser:rs},ls=(0,I.connect)(Ls,Cs)(({users:e,page:n,totalPages:t,invitees:o,externalUserMngInfo:c,isLoading:u,rolesLoading:U,loadUsers:d,fetchInvitees:M,changePage:S,updateUser:T,removeUser:us,changeSort:re})=>{const[gs,oe]=(0,v.useState)(!1),ps=c?(0,Z.G)(c):"";(0,v.useEffect)(()=>{d(),M()},[M,d]);const ie=(ms,ue)=>{T({...ue,role:ms})},le=ms=>us(ms.userId),ce=()=>{oe(!gs)},de=()=>{d()},he=()=>gs?(0,s.jsx)(p,{invitees:o}):(0,s.jsx)(y.b,{users:e,orgId:L.TP.user.orgId,rolesLoading:U,onRoleChange:ie,onRemoveUser:le,onUserRolesChange:de,fetchData:re,changePage:S,page:n,totalPages:t});return(0,s.jsxs)(b.YW.Contents,{isLoading:!u,children:[(0,s.jsx)(Ts,{onShowInvites:ce,showInvites:gs}),ps&&(0,s.jsx)(Q.F,{severity:"info",title:"",children:(0,s.jsx)("div",{dangerouslySetInnerHTML:{__html:ps}})}),u&&he()]})});function Pe(){return jsx(Page,{navId:"users",children:jsx(ls,{})})}var Ms=a(75192),vs=a(56034),Os=a(12942),Is=a(39938),cs=a(67061),Rs=a(48840),Bs=a(19384),Ss=a(23088);const Ks=e=>{if(!e.includes(" "))return{browser:e,computer:""};const n=e.split(" ");return{browser:n[0],computer:n[1]}},Ps=(e,n)=>e.length>n?e.substring(0,n)+"...":e,Ns=({value:e})=>{const n=Ks(e);return(0,s.jsx)(vs.m,{theme:"info-alt",content:e,placement:"top-end",interactive:!0,children:(0,s.jsxs)("span",{children:[Ps(n.browser,10),Ps(n.computer,10)]})})},Ws=({devices:e,showPaging:n,totalPages:t,onChangePage:o,currentPage:c,fetchData:u})=>{const U=(0,v.useMemo)(()=>[{id:"avatarUrl",header:"",cell:({cell:{value:d}})=>d&&(0,s.jsx)(Os.e,{src:d,alt:"User avatar"})},{id:"login",header:"Login",cell:({cell:{value:d}})=>"Anonymous"},{id:"userAgent",header:"User Agent",cell:({cell:{value:d}})=>(0,s.jsx)(Ns,{value:d}),sortType:"string"},{id:"updatedAt",header:"Last active",cell:({cell:{value:d}})=>d,sortType:(d,M)=>new Date(d.original.updatedAt).getTime()-new Date(M.original.updatedAt).getTime()},{id:"clientIp",header:"Origin IP (address)",cell:({cell:{value:d}})=>d&&(0,s.jsx)(Is.E,{text:d,color:"orange"})}],[]);return(0,s.jsxs)(cs.B,{direction:"column",gap:2,children:[(0,s.jsx)(Rs.j,{columns:U,data:e,getRowId:d=>d.deviceId,fetchData:u}),n&&(0,s.jsx)(cs.B,{justifyContent:"flex-end",children:(0,s.jsx)(Bs.d,{numberOfPages:t,currentPage:c,onNavigate:o})}),e.length===0&&(0,s.jsx)(Ss.Z,{children:(0,s.jsx)("span",{children:"No anonymous users found."})})]})};var q=a(57334);const $s={fetchUsersAnonymousDevices:q.xq,changeAnonUserSort:q.A5,changeAnonPage:q.is,changeAnonQuery:q.Bc},zs=e=>({devices:e.userListAnonymousDevices.devices,query:e.userListAnonymousDevices.query,showPaging:e.userListAnonymousDevices.showPaging,totalPages:e.userListAnonymousDevices.totalPages,page:e.userListAnonymousDevices.page,filters:e.userListAnonymousDevices.filters}),Qs=j.Tp.pages.UserListPage.UserListAdminPage,bs=(0,I.connect)(zs,$s)(({devices:e,fetchUsersAnonymousDevices:n,query:t,changeAnonQuery:o,filters:c,showPaging:u,totalPages:U,page:d,changeAnonPage:M,changeAnonUserSort:S})=>{const T=(0,g.of)(Fs);return(0,v.useEffect)(()=>{n()},[n]),(0,s.jsxs)(b.YW.Contents,{children:[(0,s.jsx)("div",{className:T.actionBar,"data-testid":Qs.container,children:(0,s.jsxs)("div",{className:T.row,children:[(0,s.jsx)($.Z,{placeholder:"Search devices by IP address.",autoFocus:!0,value:t,onChange:o}),(0,s.jsx)(Y.z,{options:[{label:"Active last 30 days",value:!0}],value:c.find(us=>us.name==="activeLast30Days")?.value,className:T.filter})]})}),(0,s.jsx)(Ws,{devices:e,showPaging:u,totalPages:U,onChangePage:M,currentPage:d,fetchData:S})]})});function Ae(){return jsx(Page,{navId:"anonymous-users",children:jsx(bs,{})})}const Fs=e=>({filter:(0,i.css)({margin:e.spacing(0,1),[e.breakpoints.down("sm")]:{margin:0}}),actionBar:(0,i.css)({marginBottom:e.spacing(2),display:"flex",alignItems:"flex-start",gap:e.spacing(2),[e.breakpoints.down("sm")]:{flexWrap:"wrap"}}),row:(0,i.css)({display:"flex",alignItems:"flex-start",textAlign:"left",marginBottom:e.spacing(.5),flexGrow:1,[e.breakpoints.down("sm")]:{flexWrap:"wrap",gap:e.spacing(2),width:"100%"}})}),pe=null;var Gs=a(14578),Ys=a(78369),ds=a(72686),hs=a(37390),Xs=a(39558),js=a(71678);const Zs=j.Tp.pages.UserListPage.UsersListPublicDashboardsPage.DashboardsListModal,Hs=({email:e,onDismiss:n})=>{const t=(0,g.of)(Vs),{data:o,isLoading:c}=(0,ds.kd)(e);return(0,s.jsx)(hs.a,{className:t.modal,isOpen:!0,title:x.$.featureToggles.newDashboardSharingComponent?(0,l.t)("public-dashboard-users-access-list.modal.shared-dashboard-modal-title","Shared dashboards"):(0,l.t)("public-dashboard-users-access-list.modal.dashboard-modal-title","Public dashboards"),onDismiss:n,children:c?(0,s.jsx)("div",{className:t.loading,children:(0,s.jsx)(Xs._,{text:(0,l.t)("public-dashboard-users-access-list.dashboard-modal.loading-text","Loading...")})}):o?.map(u=>(0,s.jsxs)("div",{className:t.listItem,"data-testid":Zs.listItem(u.dashboardUid),children:[(0,s.jsx)("p",{className:t.dashboardTitle,children:u.dashboardTitle}),(0,s.jsxs)("div",{className:t.urlsContainer,children:[(0,s.jsx)("a",{rel:"noreferrer",target:"_blank",className:(0,i.cx)("external-link",t.url),href:(0,P.mL)(u.publicDashboardAccessToken),onClick:n,children:x.$.featureToggles.newDashboardSharingComponent?(0,s.jsx)(l.x6,{i18nKey:"public-dashboard-users-access-list.dashboard-modal.external-link",children:"External link"}):(0,s.jsx)(l.x6,{i18nKey:"public-dashboard-users-access-list.dashboard-modal.public-dashboard-link",children:"Public dashboard URL"})}),(0,s.jsx)("span",{className:t.urlsDivider,children:"\u2022"}),(0,s.jsx)("a",{className:(0,i.cx)("external-link",t.url),href:(0,P.gN)(u.dashboardUid,u.slug),onClick:n,children:x.$.featureToggles.newDashboardSharingComponent?(0,s.jsx)(l.x6,{i18nKey:"public-dashboard-users-access-list.dashboard-modal.sharing-setting",children:"Sharing settings"}):(0,s.jsx)(l.x6,{i18nKey:"public-dashboard-users-access-list.dashboard-modal.public-dashboard-setting",children:"Public dashboard settings"})})]}),(0,s.jsx)("hr",{className:t.divider})]},u.dashboardUid))})},Js=({email:e})=>{const n=(0,l.t)("public-dashboard-users-access-list.dashboard-modal.open-dashboard-list-text","Open dashboards list");return(0,s.jsx)(js.$s,{children:({showModal:t,hideModal:o})=>(0,s.jsx)(A.$n,{variant:"secondary",size:"sm",icon:"question-circle",title:n,"aria-label":n,onClick:()=>t(Hs,{email:e,onDismiss:o})})})},Vs=e=>({modal:(0,i.css)`
    width: 590px;
  `,loading:(0,i.css)`
    display: flex;
    justify-content: center;
  `,listItem:(0,i.css)`
    display: flex;
    flex-direction: column;
    gap: ${e.spacing(.5)};
  `,divider:(0,i.css)`
    margin: ${e.spacing(1.5,0)};
    color: ${e.colors.text.secondary};
  `,urlsContainer:(0,i.css)`
    display: flex;
    gap: ${e.spacing(.5)};

    ${e.breakpoints.down("sm")} {
      flex-direction: column;
    }
  `,urlsDivider:(0,i.css)`
    color: ${e.colors.text.secondary};
    ${e.breakpoints.down("sm")} {
      display: none;
    }
  `,dashboardTitle:(0,i.css)`
    font-size: ${e.typography.body.fontSize};
    font-weight: ${e.typography.fontWeightBold};
    margin-bottom: 0;
  `,url:(0,i.css)`
    font-size: ${e.typography.body.fontSize};
  `}),ws=({user:e,hideModal:n})=>{const[t]=(0,ds.g9)(),o=(0,g.of)(_s),c=()=>{t({email:e.email}),n()};return(0,s.jsxs)(hs.a,{className:o.modal,isOpen:!0,title:(0,l.t)("public-dashboard-users-access-list.delete-user-modal.revoke-access-title","Revoke access"),onDismiss:n,children:[(0,s.jsx)("p",{className:o.description,children:(0,s.jsxs)(l.x6,{i18nKey:"public-dashboard-users-access-list.delete-user-modal.revoke-user-access-modal-desc-line1",children:["Are you sure you want to revoke access for ",{email:e.email},"?"]})}),(0,s.jsx)("p",{className:o.description,children:x.$.featureToggles.newDashboardSharingComponent?(0,s.jsxs)(l.x6,{i18nKey:"public-dashboard-users-access-list.delete-user-shared-dashboards-modal.revoke-user-access-modal-desc-line2",shouldUnescape:!0,children:["This action will immediately revoke ",{email:e.email},"'s access to all shared dashboards."]}):(0,s.jsxs)(l.x6,{i18nKey:"public-dashboard-users-access-list.delete-user-modal.revoke-user-access-modal-desc-line2",shouldUnescape:!0,children:["This action will immediately revoke ",{email:e.email},"'s access to all public dashboards."]})}),(0,s.jsxs)(hs.a.ButtonRow,{children:[(0,s.jsx)(A.$n,{type:"button",variant:"secondary",onClick:n,fill:"outline",children:(0,s.jsx)(l.x6,{i18nKey:"public-dashboard-users-access-list.delete-user-modal.delete-user-cancel-button",children:"Cancel"})}),(0,s.jsx)(A.$n,{type:"button",variant:"destructive",onClick:c,children:(0,s.jsx)(l.x6,{i18nKey:"public-dashboard-users-access-list.delete-user-modal.delete-user-revoke-access-button",children:"Revoke access"})})]})]})},ks=({user:e})=>{const n=(0,l.t)("public-dashboard-users-access-list.delete-user-modal.delete-user-button-text","Delete user");return(0,s.jsx)(js.$s,{children:({showModal:t,hideModal:o})=>(0,s.jsx)(A.$n,{size:"sm",variant:"destructive",onClick:()=>t(ws,{user:e,hideModal:o}),icon:"times","aria-label":n,title:n})})},_s=e=>({modal:(0,i.css)({width:"500px"}),description:(0,i.css)({fontSize:e.typography.body.fontSize,margin:0})}),qs=j.Tp.pages.UserListPage.publicDashboards,se=()=>{const{data:e,isLoading:n}=(0,ds.AK)();return(0,s.jsx)(b.YW.Contents,{isLoading:n,children:(0,s.jsxs)("table",{className:"filter-table form-inline","data-testid":qs.container,children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:(0,s.jsx)(l.x6,{i18nKey:"public-dashboard-users-access-list.table-header.email-label",children:"Email"})}),(0,s.jsxs)("th",{children:[(0,s.jsx)("span",{children:(0,s.jsx)(l.x6,{i18nKey:"public-dashboard-users-access-list.table-header.activated-label",children:"Activated"})}),(0,s.jsx)(vs.m,{placement:"top",content:(0,l.t)("public-dashboard-users-access-list.table-header.activated-tooltip","Earliest time user has been an active user to a dashboard"),children:(0,s.jsx)(Gs.I,{name:"info-circle"})})]}),(0,s.jsx)("th",{children:(0,s.jsx)(l.x6,{i18nKey:"public-dashboard-users-access-list.table-header.last-active-label",children:"Last active"})}),(0,s.jsx)("th",{children:(0,s.jsx)(l.x6,{i18nKey:"public-dashboard-users-access-list.table-header.origin-label",children:"Origin"})}),(0,s.jsx)("th",{children:(0,s.jsx)(l.x6,{i18nKey:"public-dashboard-users-access-list.table-header.role-label",children:"Role"})}),(0,s.jsx)("th",{})]})}),(0,s.jsx)("tbody",{children:e?.map(t=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{className:"max-width-10",children:(0,s.jsx)("span",{className:"ellipsis",title:t.email,children:t.email})}),(0,s.jsx)("td",{className:"max-width-10",children:t.firstSeenAtAge}),(0,s.jsx)("td",{className:"max-width-10",children:t.lastSeenAtAge}),(0,s.jsx)("td",{className:"max-width-10",children:(0,s.jsxs)(cs.B,{gap:2,children:[(0,s.jsxs)("span",{children:[t.totalDashboards," dashboard(s)"]}),(0,s.jsx)(Js,{email:t.email})]})}),(0,s.jsx)("td",{className:"max-width-10",children:(0,s.jsx)(Ys.v,{name:"Viewer",colorIndex:19})}),(0,s.jsx)("td",{className:"text-right",children:(0,s.jsx)(ks,{user:t})})]},t.email))})]})})};var ee=(e=>(e.ADMIN="admin",e.ORG="org",e.PUBLIC_DASHBOARDS="public-dashboards",e.ANON="anon",e))(ee||{});const w=j.Tp.pages.UserListPage,As=({view:e,setView:n})=>(0,s.jsx)(m.o,{label:x.$.featureToggles.newDashboardSharingComponent?(0,l.t)("users-access-list.tabs.shared-dashboard-users-tab-title","Shared dashboard users"):(0,l.t)("users-access-list.tabs.public-dashboard-users-tab-title","Public dashboard users"),active:e==="public-dashboards",onChangeTab:()=>n("public-dashboards"),"data-testid":w.tabs.publicDashboardsUsers}),ae={admin:(0,s.jsx)(Ms.PU,{}),org:(0,s.jsx)(ls,{}),"public-dashboards":(0,s.jsx)(se,{}),anon:(0,s.jsx)(bs,{})};function ne(){const e=(0,g.of)(te),n=f.TP.hasPermission(E.AccessControlAction.UsersRead),t=f.TP.hasPermission(E.AccessControlAction.OrgUsersRead),[o,c]=(0,v.useState)(()=>n?"admin":t?"org":null),u=t&&n;return(0,s.jsxs)(b.YW,{navId:"global-users",children:[u?(0,s.jsxs)(O.U,{className:e.tabsMargin,children:[(0,s.jsx)(m.o,{label:"All users",active:o==="admin",onChangeTab:()=>c("admin"),"data-testid":w.tabs.allUsers}),(0,s.jsx)(m.o,{label:"Organization users",active:o==="org",onChangeTab:()=>c("org"),"data-testid":w.tabs.orgUsers}),x.$.anonymousEnabled&&(0,s.jsx)(m.o,{label:"Anonymous devices",active:o==="anon",onChangeTab:()=>c("anon"),"data-testid":w.tabs.anonUserDevices}),(0,P.AY)()&&(0,s.jsx)(As,{view:o,setView:c})]}):(0,P.AY)()&&(0,s.jsxs)(O.U,{className:e.tabsMargin,children:[(0,s.jsx)(m.o,{label:"Users",active:o==="org",onChangeTab:()=>c("org"),"data-testid":w.tabs.users}),(0,s.jsx)(As,{view:o,setView:c})]}),o?ae[o]:(0,s.jsx)(ls,{})]})}const te=e=>({tabsMargin:(0,i.css)({marginBottom:e.spacing(3)})})},69546:(k,D,a)=>{a.d(D,{b:()=>J});var s=a(74848),i=a(96540),v=a(13544),j=a(12942),x=a(94753),m=a(90613),g=a(56034),O=a(14578),l=a(78369),f=a(55852),P=a(67061),b=a(48840),E=a(19384),I=a(96374),Z=a(89062),Q=a(85927),L=a(46334),y=a(10096),R=a(31678),A=a(5133);const F=`This user's role is not editable because it is synchronized from your auth provider.
Refer to the Grafana authentication docs for details.`,G=B=>{const p=B?.isExternallySynced;return!y.TP.hasPermissionInMetadata(R.AccessControlAction.OrgUsersWrite,B)||p},H=v.Tp.pages.UserListPage.UsersListPage,J=({users:B,orgId:p,onRoleChange:K,onUserRolesChange:N,onRemoveUser:W,fetchData:xs,changePage:ss,page:es,totalPages:as,rolesLoading:_})=>{const[$,Y]=(0,i.useState)(null),[V,ns]=(0,i.useState)([]);(0,i.useEffect)(()=>{async function r(){try{if(y.TP.hasPermission(R.AccessControlAction.ActionRolesList)){let h=await(0,Q.RL)(p);ns(h)}}catch{console.error("Error loading options")}}y.TP.licensedAccessControlEnabled()&&r()},[p]);const X=(0,i.useMemo)(()=>[{id:"avatarUrl",header:"",cell:({cell:{value:r}})=>r&&(0,s.jsx)(j.e,{src:r,alt:"User avatar"})},{id:"login",header:"Login",cell:({cell:{value:r}})=>(0,s.jsx)("div",{children:r}),sortType:"string"},{id:"email",header:"Email",cell:({cell:{value:r}})=>r,sortType:"string"},{id:"name",header:"Name",cell:({cell:{value:r}})=>r,sortType:"string"},{id:"lastSeenAtAge",header:"Last active",cell:({cell:{value:r}})=>(0,s.jsx)(s.Fragment,{children:r&&(0,s.jsx)(s.Fragment,{children:r==="10 years"?(0,s.jsx)(x.E,{color:"disabled",children:"Never"}):r})}),sortType:(r,h)=>new Date(r.original.lastSeenAt).getTime()-new Date(h.original.lastSeenAt).getTime()},{id:"role",header:"Role",cell:({cell:{value:r},row:{original:h}})=>{const C=G(h),ts=async(z,rs,os)=>{await(0,Q.eA)(z,rs,os),N&&N()};return y.TP.licensedAccessControlEnabled()?(0,s.jsx)(Z.y,{userId:h.userId,roles:h.roles,apply:!0,onApplyRoles:ts,isLoading:_,orgId:p,roleOptions:V,basicRole:r,onBasicRoleChange:z=>K(z,h),basicRoleDisabled:C,basicRoleDisabledMessage:F,width:40}):(0,s.jsx)(A.r,{"aria-label":"Role",value:r,disabled:C,onChange:z=>K(z,h)})}},{id:"info",header:"",cell:({row:{original:r}})=>G(r)&&(0,s.jsx)(m.a,{display:"flex",alignItems:"center",marginLeft:1,children:(0,s.jsx)(g.m,{interactive:!0,content:(0,s.jsxs)("div",{children:["This user's role is not editable because it is synchronized from your auth provider. Refer to the\xA0",(0,s.jsx)("a",{href:"https://grafana.com/docs/grafana/latest/administration/user-management/manage-org-users/#change-a-users-organization-permissions",rel:"noreferrer",target:"_blank",children:"Grafana authentication docs"}),"\xA0for details."]}),children:(0,s.jsx)(O.I,{name:"question-circle"})})})},{id:"authLabels",header:"Origin",cell:({cell:{value:r}})=>(0,s.jsx)(s.Fragment,{children:Array.isArray(r)&&r.length>0&&(0,s.jsx)(L.E,{label:r[0],removeIcon:!1,count:0})})},{id:"isDisabled",header:"",cell:({cell:{value:r}})=>(0,s.jsx)(s.Fragment,{children:r&&(0,s.jsx)(l.v,{colorIndex:9,name:"Disabled"})})},{id:"delete",header:"",cell:({row:{original:r}})=>y.TP.hasPermissionInMetadata(R.AccessControlAction.OrgUsersRemove,r)&&(0,s.jsx)(f.$n,{size:"sm",variant:"destructive",onClick:()=>{Y(r)},icon:"times","aria-label":`Delete user ${r.name}`})}],[_,p,V,N,K]);return(0,s.jsxs)(P.B,{direction:"column",gap:2,"data-testid":H.container,children:[(0,s.jsx)(b.j,{columns:X,data:B,getRowId:r=>String(r.userId),fetchData:xs}),(0,s.jsx)(P.B,{justifyContent:"flex-end",children:(0,s.jsx)(E.d,{onNavigate:ss,currentPage:es,numberOfPages:as,hideWhenSinglePage:!0})}),!!$&&(0,s.jsx)(I.u,{body:`Are you sure you want to delete user ${$?.login}?`,confirmText:"Delete",title:"Delete",onDismiss:()=>{Y(null)},isOpen:!0,onConfirm:()=>{$&&(W($),Y(null))}})]})}},23088:(k,D,a)=>{a.d(D,{Z:()=>j});var s=a(74848),i=a(32196),v=a(40845);const j=({children:m})=>{const g=(0,v.of)(x);return(0,s.jsx)("div",{className:g.container,children:m})},x=m=>({container:(0,i.css)({backgroundColor:m.colors.background.secondary,color:m.colors.text.secondary,padding:m.spacing(4),textAlign:"center"})})}}]);

//# sourceMappingURL=UserListPage.7f50d521e95a2a7bd211.js.map