"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[847],{41603:(K,M,t)=>{t.r(M),t.d(M,{DataSourceInsightsPage:()=>S,default:()=>L});var u=t(74848),n=t(54148),E=t(21780),l=t(31152),r=t(18526);const S=()=>{const{uid:h=""}=(0,n.g)(),{navId:R,pageNav:P}=(0,l.n)("insights");return(0,u.jsx)(E.YW,{navId:R,pageNav:P,children:(0,u.jsx)(E.YW.Contents,{children:(0,u.jsx)(r.A,{uid:h})})})},L=S},18526:(K,M,t)=>{t.d(M,{A:()=>N});var u=t(74848),n=t(96540),E=t(71468),l=t(70713),r=t(47232),S=t(11261),L=t(39070),h=t(33378),R=t(24308),P=t(52622),U=t(91052),v=t(37166),A=t(40845),y=t(77454),F=t(35538),m=t(34258),D=t(41067),f=t(10505);const x=(C,i)=>({dataSourceUid:i.uid}),I={loadDataSource:m.ak,loadDataSourceMeta:m.xI},B=(0,E.connect)(x,I);class W extends n.PureComponent{constructor(i){super(i),this.state={dailySummaries:[],from:"",to:""}}async componentDidMount(){const{dataSourceUid:i,loadDataSource:s,loadDataSourceMeta:o}=this.props;if(s(i).then(o),(0,h.a)("analytics")){let c=(0,r.KQ)().subtract(30,"days").format(D.QH),d=(0,r.KQ)().format(D.QH);const p=await(0,D.FW)(i,c,d);this.setState({dailySummaries:p,from:c,to:d})}}buildTimeRange(){const{from:i,to:s}=this.state,o=(0,r.KQ)(i),c=(0,r.KQ)(s).add(24,"hours");return{from:o,to:c,raw:{from:i,to:s}}}convertDailySummariesToDataFrame(i,s,o){const c=[],d=[];return i.forEach(p=>{c.push((0,r.KQ)(p.day,D.QH).valueOf());let T=p[s];s==="loadDuration"&&(T=p.queries?p.loadDuration/(p.queries*1e6):0),d.push(T)}),{name:s,fields:[{name:"Time",type:S.PU.time,config:{},values:c},{name:s,type:o,config:{},values:d}],length:i.length}}renderChart(i,s){const{dailySummaries:o}=this.state,{color:c,fieldType:d,showBars:p,timeRange:T,title:z,valueField:Q,width:j}=i,G={series:[this.convertDailySummariesToDataFrame(o,Q,d)],state:L.Gu.Done,timeRange:T},$={legend:{showLegend:!1,displayMode:P.lm.Hidden,calcs:[],placement:"bottom"},tooltip:{mode:P.$N.Multi,sort:P.xB.Descending}},e={defaults:{color:{mode:"fixed",fixedColor:c},custom:{showPoints:P.yL.Never,drawStyle:p?P.GR.Bars:P.GR.Line,fillOpacity:p?50:0}},overrides:[]};return(0,u.jsx)("div",{className:s.graphContainer,children:(0,u.jsx)(U.NR,{title:z,width:j,height:220,displayMode:"transparent",loadingState:G.state,children:(a,_)=>(0,u.jsx)(R.m,{title:z,width:a,height:_,pluginId:"timeseries",data:G,fieldConfig:e,options:$})})})}renderContent(){const{theme:i}=this.props,s=(0,f.k)(i),{dailySummaries:o}=this.state,c=this.buildTimeRange();return o?.length>0?(0,u.jsx)(l.Ay,{disableHeight:!0,children:({width:d})=>{const p=[{title:"Queries last 30 days",valueField:"queries",fieldType:S.PU.number,width:d,timeRange:c,color:"green",showBars:!0,showLines:!1},{title:"Errors last 30 days",valueField:"errors",fieldType:S.PU.number,width:d,timeRange:c,color:i.colors.error.border,showBars:!0,showLines:!1},{title:"Average load duration last 30 days (ms)",valueField:"loadDuration",fieldType:S.PU.number,width:d,timeRange:c,color:i.colors.primary.border,showBars:!0,showLines:!1}];return(0,u.jsx)("main",{style:{width:d},children:p.map(T=>this.renderChart(T,s))})}}):(0,u.jsx)("span",{children:"No available data for this data source."})}render(){return(0,h.a)("analytics.writers")&&!(0,h.a)("analytics")?(0,u.jsx)(v.w,{title:"Feature not available with an expired license",url:"https://grafana.com/docs/grafana/latest/enterprise/license-expiration/",urlTitle:"Read more on license expiration",children:(0,u.jsx)("span",{children:"Data source insights are not available with an expired license. Data will continue to be collected but you need to update your license to see this page."})}):(0,u.jsxs)(u.Fragment,{children:[(0,F.z5)()&&(0,u.jsx)(y.Iz,{featureId:"data-source-insights",eventVariant:"trial",featureName:"data source usage insights",text:"Enable data source usage insights for free during your trial of Grafana Pro."}),this.renderContent()]})}}const N=B((0,A.cV)(W))},31152:(K,M,t)=>{t.d(M,{n:()=>h});var u=t(24180),n=t(19347),E=t(17422),l=t(11084),r=t(74984),S=t(83391),L=t(31678);function h(R){const{uid:P}=(0,u.g)(),U=(0,u.zy)(),v=(0,l.xw)(P),A=(0,l.S4)(v.type),y=(0,S.ob)(v.type),F=new URLSearchParams(U.search),m=R||F.get("page"),{plugin:D,loadError:f,loading:x}=(0,l._e)(),I=(0,n.l)()?.getInstanceSettings(P),B=!!(I?.meta?.alerting??!1),W=I?.type==="alertmanager",N=B||W,C=(0,L.useSelector)(c=>c.navIndex),i=m?`datasource-${m}-${P}`:`datasource-settings-${P}`;let s={node:{text:"Data Source Nav Node"},main:{text:"Data Source Nav Node"}};if(f){const c={text:f,subTitle:"Data Source Error",icon:"exclamation-triangle"};s={node:c,main:c}}return(x||!D)&&(s=(0,E.tc)(C,i,(0,r.$m)("settings"))),D&&(s=(0,E.tc)(C,i,(0,r.Vh)((0,r.R4)(v,D),m||"settings"))),{navId:"connections-datasources",pageNav:{...s.main,dataSourcePluginName:y?.name||D?.meta.name||"",active:!0,text:v.name,subTitle:`Type: ${A.name}`,children:(s.main.children||[]).map(c=>({...c,url:c.url?.replace("datasources/edit/","/connections/datasources/edit/")}))},dataSourceHeader:{alertingSupported:N}}}},458:(K,M,t)=>{t.d(M,{C:()=>E});var u=t(96540),n=t(83883);const E=(0,u.createContext)(n.I)},11084:(K,M,t)=>{t.d(M,{$k:()=>x,BY:()=>A,S4:()=>W,Tn:()=>B,US:()=>y,Um:()=>D,_e:()=>N,aM:()=>i,hx:()=>m,k9:()=>f,oU:()=>v,u1:()=>C,xw:()=>I});var u=t(96540),n=t(97007),E=t(28138),l=t(10096),r=t(31678),S=t(28444),L=t(11959),h=t(34258),R=t(458),P=t(36227),U=t(54226);const v=s=>{const o=(0,r.useDispatch)();(0,u.useEffect)(()=>(o((0,h.PK)(s)),function(){o((0,n.N)({cleanupAction:d=>d.dataSourceSettings=P.IJ}))}),[s,o])},A=s=>{const o=(0,r.useDispatch)(),c=i();return()=>o((0,h.Ge)(s,c.Edit))},y=()=>{const s=(0,r.useDispatch)(),o=(0,r.useSelector)(d=>d.dataSources.isLoadingDataSources),c=(0,r.useSelector)(d=>d.dataSources.dataSources);return(0,u.useEffect)(()=>{s((0,h.bn)())},[s]),{isLoading:o,dataSources:c}},F=s=>{const o=useDispatch();useEffect(()=>{o(loadDataSource(s))},[o,s])},m=()=>{const s=(0,r.useDispatch)();(0,u.useEffect)(()=>{s((0,h.G2)())},[s])},D=()=>{const s=(0,r.useDispatch)(),o=i();return c=>{s((0,h.du)(c,o.Edit))}},f=()=>{const s=(0,r.useDispatch)();return async o=>s((0,h.jB)(o))},x=()=>{const s=(0,r.useDispatch)(),{name:o}=(0,r.useSelector)(c=>c.dataSources.dataSource);return()=>{E.A.publish(new S.bY({title:"Delete",text:`Are you sure you want to delete the "${o}" data source?`,yesText:"Delete",icon:"trash-alt",onConfirm:()=>s((0,h.Qq)())}))}},I=s=>(0,r.useSelector)(o=>(0,U.U4)(o.dataSources,s)),B=s=>{const o=I(s);return(0,L.h)(o)},W=s=>(0,r.useSelector)(o=>(0,U.Fj)(o.dataSources,s)),N=()=>(0,r.useSelector)(s=>s.dataSourceSettings),C=s=>{const o=I(s),c=o.readOnly===!0,d=l.TP.hasPermissionInMetadata(r.AccessControlAction.DataSourcesWrite,o),p=l.TP.hasPermissionInMetadata(r.AccessControlAction.DataSourcesDelete,o);return{readOnly:c,hasWriteRights:d,hasDeleteRights:p}},i=()=>(0,u.useContext)(R.C)},11959:(K,M,t)=>{t.d(M,{h:()=>E});var u=t(76885),n=t(71733);const E=l=>{const r=JSON.stringify({datasource:l.name,context:"explore"});return u.kM.renderUrl(n.I.assureBaseUrl("/explore"),{left:r})}},83391:(K,M,t)=>{t.d(M,{A5:()=>$,wr:()=>T,m5:()=>p,PW:()=>I,F9:()=>C,ob:()=>W,sM:()=>B,xX:()=>i,XN:()=>z,pw:()=>c,Gp:()=>o,qG:()=>Q,SQ:()=>s});var u=t(96540),n=t(31678),E=t(5129),l=t(20701),r=t(25508),S=t(54479),L=t(14110),h=t(66253),R=t(31326);const P=e=>e.plugins,U=(0,r.Mz)(P,({items:e})=>e),{selectAll:v,selectById:A}=R.AI.getSelectors(U),y=e=>(0,r.Mz)(v,a=>{const _=e.keyword?(0,S.xb)(e.keyword.toLowerCase()):"",g=_!==""?(0,E.TD)(a,_):null;return _&&(0,L.rR)("plugins_search",{resultsCount:g?.length}),a.filter(O=>!(_&&g==null||_&&!g?.includes(O.id)||e.type&&O.type!==e.type||e.isInstalled!==void 0&&O.isInstalled!==e.isInstalled||e.isEnterprise!==void 0&&O.isEnterprise!==e.isEnterprise||e.hasUpdate!==void 0&&(O.hasUpdate!==e.hasUpdate||!(0,E.R7)(O))))}),F=e=>(0,r.Mz)(v,a=>{const _=[];for(const g of a)g.error&&(!e||g.type===e)&&_.push({pluginId:g.id,errorCode:g.error,pluginType:g.type});return _}),m=e=>(0,r.Mz)(P,({requests:a={}})=>a[e]),D=e=>(0,r.Mz)(m(e),a=>a?.status===h.IZ.Pending),f=e=>(0,r.Mz)(m(e),a=>a?.status===h.IZ.Rejected?a?.error:null),x=e=>(0,r.Mz)(m(e),a=>a===void 0),I=(e,a=E.by.nameAsc)=>{j();const _=(0,u.useMemo)(()=>y(e),[e]),g=(0,n.useSelector)(_),{isLoading:O,error:J}=d(),X=(0,E.Xc)(g,a);return{isLoading:O,error:J,plugins:X}},B=()=>{const{isLoading:e}=p(),{plugins:a}=I({isInstalled:!0}),_=a.filter(E.R7);return{isLoading:e,updatablePlugins:_}},W=e=>(j(),G(e),(0,n.useSelector)(a=>A(a,e))),N=e=>(H(),useSelector(a=>selectById(a,e))),C=e=>(j(),(0,n.useSelector)(F(e))),i=()=>{const e=(0,n.useDispatch)();return(a,_,g)=>e((0,l.ai)({id:a,version:_,isUpdating:g}))},s=()=>{const e=(0,n.useDispatch)();return()=>e((0,l.nT)())},o=()=>{const e=(0,n.useDispatch)();return a=>e((0,l.JC)(a))},c=()=>(0,n.useSelector)(f(l.JJ.typePrefix))===null,d=()=>{const e=(0,n.useSelector)(D("plugins/fetchLocal")),a=(0,n.useSelector)(f("plugins/fetchLocal"));return{isLoading:e,error:a}},p=()=>{const e=(0,n.useSelector)(D(l.mj.typePrefix)),a=(0,n.useSelector)(D("plugins/fetchLocal")),_=(0,n.useSelector)(D("plugins/fetchRemote")),g=e||a||_,O=(0,n.useSelector)(f(l.mj.typePrefix));return{isLoading:g,error:O}},T=()=>{const e=(0,n.useSelector)(D(l.t5.typePrefix)),a=(0,n.useSelector)(f(l.t5.typePrefix));return{isLoading:e,error:a}},z=()=>{const e=(0,n.useSelector)(D(l.ai.typePrefix)),a=(0,n.useSelector)(f(l.ai.typePrefix));return{isInstalling:e,error:a}},Q=()=>{const e=(0,n.useSelector)(D(l.JC.typePrefix)),a=(0,n.useSelector)(f(l.JC.typePrefix));return{isUninstalling:e,error:a}},j=()=>{const e=(0,n.useDispatch)(),a=(0,n.useSelector)(x(l.mj.typePrefix));(0,u.useEffect)(()=>{a&&e((0,l.mj)())},[])},H=()=>{const e=useDispatch(),a=useSelector(selectIsRequestNotFetched(fetchAllLocal.typePrefix));useEffect(()=>{a&&e(fetchAllLocal())},[])},G=e=>{const a=(0,n.useDispatch)(),_=(0,n.useSelector)(J=>A(J,e)),O=!(0,n.useSelector)(D(l.t5.typePrefix))&&_&&!_.details;(0,u.useEffect)(()=>{O&&a((0,l.t5)(e))},[_])},$=()=>{const e=(0,n.useDispatch)();return a=>e((0,l.t5)(a))}}}]);

//# sourceMappingURL=ConnectionsDataSourceInsightsPage.8869c00fd8c384eb52e5.js.map